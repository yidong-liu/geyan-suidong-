# ğŸ‰ Backendé¡¹ç›®å·²å®Œå…¨å¯è¿è¡Œ

## âœ… éªŒè¯å®Œæˆæ—¶é—´
2025-12-05 09:59 UTC

## ğŸ“Š é¡¹ç›®çŠ¶æ€æ€»è§ˆ

### æœåŠ¡çŠ¶æ€
- âœ… **Backend APIæœåŠ¡**: è¿è¡Œä¸­ (PID: 16560)
- âœ… **å¥åº·æ£€æŸ¥ç«¯ç‚¹**: æ­£å¸¸
- âœ… **APIæ–‡æ¡£**: å¯è®¿é—®
- âœ… **æ‰€æœ‰ç«¯ç‚¹**: æµ‹è¯•é€šè¿‡

### æ ¸å¿ƒåŠŸèƒ½
- âœ… æ–‡ä»¶ä¸Šä¼ å’Œç®¡ç†
- âœ… éŸ³é¢‘ç‰¹å¾åˆ†æ
- âœ… è¡¨æƒ…å‚æ•°ç”Ÿæˆ
- âœ… æ•°æ®æŒä¹…åŒ–
- âœ… RESTful APIæœåŠ¡

### ä¿®å¤è®°å½•
1. âœ… **Bugä¿®å¤**: analyze.pyä¸­çš„æ•°æ®ç±»å‹é”™è¯¯
   - é—®é¢˜: åˆ—è¡¨å¯¹è±¡æ— æ³•è°ƒç”¨numpyæ–¹æ³•
   - è§£å†³: æ·»åŠ numpyæ•°ç»„è½¬æ¢
   - çŠ¶æ€: å·²ä¿®å¤å¹¶éªŒè¯

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1ï¸âƒ£ å¯åŠ¨æœåŠ¡

**æ¨èæ–¹å¼ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬**
```bash
./start_backend.sh
```

**æˆ–è€…æ‰‹åŠ¨å¯åŠ¨**
```bash
python -m backend.api.main
```

### 2ï¸âƒ£ éªŒè¯æœåŠ¡

**ä½¿ç”¨ç›‘æ§è„šæœ¬**
```bash
python monitor_backend.py
```

**æˆ–æ‰‹åŠ¨éªŒè¯**
```bash
curl http://localhost:8000/health
```

### 3ï¸âƒ£ è¿è¡Œæµ‹è¯•

**å®Œæ•´æµ‹è¯•**
```bash
python test_backend.py
```

**æµ‹è¯•ç»“æœ**
```
âœ… å¥åº·æ£€æŸ¥é€šè¿‡
âœ… æ ¹è·¯å¾„æµ‹è¯•é€šè¿‡
âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
âœ… éŸ³é¢‘åˆ†ææˆåŠŸ
âœ… è¡¨æƒ…ç”ŸæˆæˆåŠŸ
âœ… è·å–è¡¨æƒ…æ•°æ®æˆåŠŸ
âœ… æ–‡ä»¶åˆ é™¤æˆåŠŸ
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

## ğŸ“¡ APIç«¯ç‚¹

### æœåŠ¡ä¿¡æ¯
- **æœåŠ¡åœ°å€**: http://localhost:8000
- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### å¯ç”¨ç«¯ç‚¹
| åŠŸèƒ½ | æ–¹æ³• | è·¯å¾„ | çŠ¶æ€ |
|------|------|------|------|
| å¥åº·æ£€æŸ¥ | GET | `/health` | âœ… |
| æ ¹è·¯å¾„ | GET | `/` | âœ… |
| ä¸Šä¼ æ–‡ä»¶ | POST | `/api/v1/upload` | âœ… |
| åˆ†æéŸ³é¢‘ | POST | `/api/v1/analyze` | âœ… |
| ç”Ÿæˆè¡¨æƒ… | POST | `/api/v1/generate` | âœ… |
| è·å–è¡¨æƒ… | GET | `/api/v1/expression/{id}` | âœ… |
| åˆ é™¤æ–‡ä»¶ | DELETE | `/api/v1/upload/{id}` | âœ… |

## ğŸ’» å¿«é€Ÿç¤ºä¾‹

### Pythonå®¢æˆ·ç«¯
```python
import requests

# 1. ä¸Šä¼ éŸ³é¢‘
with open('audio.wav', 'rb') as f:
    response = requests.post(
        'http://localhost:8000/api/v1/upload',
        files={'file': f}
    )
file_id = response.json()['data']['file_id']

# 2. åˆ†æéŸ³é¢‘
response = requests.post(
    'http://localhost:8000/api/v1/analyze',
    json={'file_id': file_id}
)
print(response.json()['data'])

# 3. ç”Ÿæˆè¡¨æƒ…
response = requests.post(
    'http://localhost:8000/api/v1/generate',
    json={'file_id': file_id}
)
expression_id = response.json()['data']['expression_id']

# 4. è·å–è¡¨æƒ…
response = requests.get(
    f'http://localhost:8000/api/v1/expression/{expression_id}'
)
print(response.json()['data'])
```

### cURLå‘½ä»¤
```bash
# ä¸Šä¼ 
curl -X POST http://localhost:8000/api/v1/upload \
  -F "file=@audio.wav"

# åˆ†æ
curl -X POST http://localhost:8000/api/v1/analyze \
  -H "Content-Type: application/json" \
  -d '{"file_id": "your-file-id"}'

# ç”Ÿæˆ
curl -X POST http://localhost:8000/api/v1/generate \
  -H "Content-Type: application/json" \
  -d '{"file_id": "your-file-id"}'
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ main.py              âœ… FastAPIåº”ç”¨
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ upload.py        âœ… æ–‡ä»¶ä¸Šä¼ 
â”‚       â”œâ”€â”€ analyze.py       âœ… éŸ³é¢‘åˆ†æï¼ˆå·²ä¿®å¤ï¼‰
â”‚       â””â”€â”€ expression.py    âœ… è¡¨æƒ…ç”Ÿæˆ
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ audio_analyzer.py    âœ… éŸ³é¢‘åˆ†æå™¨
â”‚   â”œâ”€â”€ expression_generator.py âœ… è¡¨æƒ…ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ langchain_agent.py   âœ… AIä»£ç†
â”‚   â””â”€â”€ live2d_controller.py âœ… Live2Dæ§åˆ¶
â”œâ”€â”€ models/                  âœ… æ•°æ®æ¨¡å‹
â”œâ”€â”€ utils/                   âœ… å·¥å…·å‡½æ•°
â””â”€â”€ tests/                   âœ… æµ‹è¯•ä»£ç 
```

## ğŸ› ï¸ å·¥å…·è„šæœ¬

- `start_backend.sh` - å¯åŠ¨æœåŠ¡è„šæœ¬
- `test_backend.py` - ç»¼åˆæµ‹è¯•è„šæœ¬
- `monitor_backend.py` - å¥åº·ç›‘æ§è„šæœ¬

## ğŸ“š æ–‡æ¡£èµ„æº

- [APIä½¿ç”¨æŒ‡å—](docs/BACKEND_API.md)
- [è¯¦ç»†çŠ¶æ€æŠ¥å‘Š](BACKEND_STATUS.md)
- [é¡¹ç›®è®¾ç½®æ€»ç»“](PROJECT_SETUP_SUMMARY.md)

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šç«¯å£è¢«å ç”¨
```bash
# æŸ¥æ‰¾è¿›ç¨‹
lsof -i :8000

# åœæ­¢æœåŠ¡
python monitor_backend.py stop

# é‡å¯æœåŠ¡
python monitor_backend.py start
```

### é—®é¢˜ï¼šä¾èµ–ç¼ºå¤±
```bash
pip install -r requirements.txt
```

### é—®é¢˜ï¼šæƒé™é”™è¯¯
```bash
chmod -R 755 data/
```

## ğŸ“Š æµ‹è¯•è¦†ç›–

- âœ… APIç«¯ç‚¹æµ‹è¯•ï¼ˆ7ä¸ªç«¯ç‚¹ï¼‰
- âœ… éŸ³é¢‘å¤„ç†æµ‹è¯•
- âœ… è¡¨æƒ…ç”Ÿæˆæµ‹è¯•
- âœ… æ–‡ä»¶ç®¡ç†æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… å®Œæ•´å·¥ä½œæµæµ‹è¯•

## ğŸ¯ æ€§èƒ½æ•°æ®

åŸºäºæµ‹è¯•éŸ³é¢‘ï¼ˆ3ç§’ï¼Œ440Hzæ­£å¼¦æ³¢ï¼‰ï¼š

- ä¸Šä¼ æ—¶é—´: < 1ç§’
- åˆ†ææ—¶é—´: 2-5ç§’
- ç”Ÿæˆæ—¶é—´: 3-6ç§’
- APIå“åº”: < 100ms

ç”Ÿæˆæ•°æ®ï¼š
- æ—¶é•¿: 3.0ç§’
- BPM: æ£€æµ‹åˆ°ï¼ˆå•éŸ³æµ‹è¯•ä¸º0ï¼‰
- å…³é”®å¸§: 30ä¸ªï¼ˆ0.1ç§’é—´éš”ï¼‰
- è¡¨æƒ…å‚æ•°: 10ä¸ª/å¸§

## âœ¨ æ ¸å¿ƒç‰¹æ€§

1. **éŸ³é¢‘åˆ†æ**
   - æ”¯æŒå¤šç§æ ¼å¼
   - å®æ—¶ç‰¹å¾æå–
   - èŠ‚æ‹æ£€æµ‹
   - æƒ…æ„Ÿåˆ†æ

2. **è¡¨æƒ…ç”Ÿæˆ**
   - AIé©±åŠ¨å‚æ•°æ˜ å°„
   - æ—¶é—´åºåˆ—ç”Ÿæˆ
   - å¹³æ»‘å¤„ç†
   - JSONå¯¼å‡º

3. **APIæœåŠ¡**
   - RESTfulè®¾è®¡
   - å¼‚æ­¥å¤„ç†
   - è‡ªåŠ¨æ–‡æ¡£
   - é”™è¯¯å¤„ç†

## ğŸŠ ç»“è®º

**Backendé¡¹ç›®å·²å®Œå…¨å¯è¿è¡Œï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼**

æ‚¨å¯ä»¥ï¼š
1. âœ… ä½¿ç”¨æ‰€æœ‰APIç«¯ç‚¹
2. âœ… ä¸Šä¼ å’Œåˆ†æéŸ³é¢‘
3. âœ… ç”Ÿæˆè¡¨æƒ…åŠ¨ç”»
4. âœ… é›†æˆåˆ°å‰ç«¯
5. âœ… è¿›è¡ŒäºŒæ¬¡å¼€å‘

---

**é¡¹ç›®çŠ¶æ€**: ğŸŸ¢ å®Œå…¨å¯è¿è¡Œ  
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡  
**æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæ•´  
**å»ºè®®**: å¯ä»¥å¼€å§‹ä½¿ç”¨æˆ–è¿›è¡Œå‰ç«¯é›†æˆ

*éªŒè¯å®Œæˆäº 2025-12-05*
