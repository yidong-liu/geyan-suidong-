# 歌颜随动 - 用户使用指南 v1.0

> 让歌声拥有表情，让虚拟陪伴真实

## 📖 目录

- [快速开始](#快速开始)
- [功能介绍](#功能介绍)
- [使用教程](#使用教程)
- [常见问题](#常见问题)

---

## 🚀 快速开始

### 系统要求

- Python 3.8+
- FFmpeg（音频处理）
- 8GB RAM（推荐）
- 稳定的网络连接（用于AI API）

### 安装步骤

#### 1. 克隆项目

```bash
git clone https://github.com/yidong-liu/geyan-suidong-.git
cd geyan-suidong-
```

#### 2. 安装依赖

```bash
pip install -r requirements.txt
```

#### 3. 配置API密钥

创建 `.env` 文件并添加：

```env
GOOGLE_API_KEY=your_google_api_key_here
GOOGLE_MODEL=gemini-2.0-flash-exp
```

#### 4. 启动服务

```bash
# 启动完整系统（推荐）
./start_all.sh

# 或分别启动
./start_backend.sh   # 后端API (端口8000)
./start_frontend.sh  # 前端界面 (端口8501)
```

#### 5. 访问应用

- **前端界面**: http://localhost:8501
- **后端API**: http://localhost:8000
- **API文档**: http://localhost:8000/docs

---

## ✨ 功能介绍

### 🎵 核心功能

1. **智能音频分析**
   - 节拍检测（BPM）
   - 音调分析
   - 能量曲线
   - AI情感识别

2. **表情自动生成**
   - 基于音乐特征的AI表情生成
   - Live2D参数映射
   - 时间轴同步
   - 平滑过渡处理

3. **实时预览**
   - Live2D模型展示
   - 音乐同步播放
   - 参数实时显示
   - 表情文件导出

### 🎭 支持的音频格式

- MP3
- WAV
- M4A
- FLAC
- OGG

---

## 📚 使用教程

### 步骤1：上传音频

1. 打开应用，点击侧边栏 **📤 音频上传**
2. 点击 **"浏览文件"** 选择音频文件
3. 系统会自动显示：
   - 文件信息（大小、格式）
   - 音频播放器

### 步骤2：配置参数

在处理选项区域设置：

- **时间分辨率**: 0.1秒（默认）
  - 更小的值 = 更精细的表情控制
  - 推荐范围: 0.05-0.5秒

- **平滑处理**: 开启（推荐）
  - 使表情过渡更自然

- **表情敏感度**: 1.0（默认）
  - 高敏感度: 1.5-2.0（更夸张的表情）
  - 低敏感度: 0.5-0.8（更温和的表情）

### 步骤3：开始处理

1. 点击 **🚀 开始分析与生成** 按钮
2. 等待处理完成，系统会依次：
   - 📤 上传文件到服务器
   - 🎵 分析音频特征（约5-10秒）
   - 🎭 生成表情动画（约10-20秒）
3. 查看处理结果统计

### 步骤4：预览表情

1. 处理完成后，自动跳转到 **👀 Live2D预览** 页面
2. 使用播放控制：
   - ▶️ 播放
   - ⏸️ 暂停
   - ⏹️ 停止
   - 🔄 重置
3. 拖动进度条查看不同时间点的表情
4. 查看实时参数显示：
   - 眼睛开合度
   - 嘴部开合度
   - 眉毛高度
   - 脸颊红晕

### 步骤5：导出结果

点击 **📥 导出表情文件** 查看文件路径，表情数据保存在 `data/expressions/` 目录。

---

## 🎨 表情映射规则

系统会根据音乐特征自动生成对应表情：

### 节奏特征

| 音乐特征 | 表情反应 |
|---------|---------|
| 强节拍 | 快速眨眼、点头 |
| 快节奏（>140 BPM） | 兴奋表情、张嘴 |
| 慢节奏（<80 BPM） | 平静表情、缓慢闭眼 |

### 情感特征

| 情感类型 | 表情参数 |
|---------|---------|
| 快乐 (Happy) | 嘴角上扬、眼睛弯曲、脸颊红晕 |
| 悲伤 (Sad) | 眉毛下垂、眼睛半闭 |
| 活力 (Energetic) | 眼睛睁大、嘴部张开 |
| 平静 (Calm) | 温和微笑、眼睛微闭 |

### 能量级别

- **高能量** (>0.7): 夸张表情、大幅度动作
- **中能量** (0.3-0.7): 自然表情、适度变化
- **低能量** (<0.3): 细微表情、轻微动作

---

## 🔧 高级设置

### API配置

支持多种AI模型：

```env
# Google Gemini
GOOGLE_API_KEY=your_key
GOOGLE_MODEL=gemini-2.0-flash-exp

# OpenAI
OPENAI_API_KEY=your_key
OPENAI_MODEL=gpt-4
```

### 表情映射自定义

编辑 `config/expression_mapping.json` 自定义表情规则：

```json
{
  "emotion_thresholds": {
    "happy": 0.6,
    "energetic": 0.7
  },
  "parameter_ranges": {
    "eye_open": [0.3, 1.0],
    "mouth_open": [0.0, 0.8]
  }
}
```

---

## ❓ 常见问题

### Q1: 处理时间很长怎么办？

**答**: 
- 音频长度影响处理时间，建议不超过5分钟
- 检查网络连接（AI分析需要调用API）
- 尝试增大时间分辨率（如改为0.2秒）

### Q2: 表情不够生动？

**答**:
- 提高表情敏感度到1.5-2.0
- 降低时间分辨率到0.05秒
- 确保使用音乐特征丰富的音频

### Q3: 支持哪些Live2D模型？

**答**:
- 目前支持 Live2D Cubism SDK 3.0+ 格式
- 模型需要包含基础表情参数
- 可以在 `models/` 目录添加自己的模型

### Q4: 如何批量处理音频？

**答**:
- 当前版本需要逐个处理
- 可以使用API直接调用批量处理
- 参考 `docs/API_REFERENCE.md`

### Q5: 表情文件如何使用？

**答**:
- 表情文件为JSON格式
- 可导入Live2D Web库使用
- 包含时间轴和参数映射
- 参考 `docs/EXPRESSION_FORMAT.md`

### Q6: 系统卡顿怎么办？

**答**:
- 检查后端服务是否正常运行
- 查看日志：`logs/backend.log`
- 重启服务：`./restart_backend.sh`
- 确保有足够的系统资源

---

## 🎯 最佳实践

### 1. 选择合适的音频

- ✅ 推荐：节奏明显、情感丰富的歌曲
- ✅ 长度：30秒 - 5分钟
- ❌ 避免：纯器乐、环境音、语音对话

### 2. 参数调优

- 流行歌曲：时间分辨率 0.1s，敏感度 1.0
- 快节奏舞曲：时间分辨率 0.05s，敏感度 1.5
- 抒情慢歌：时间分辨率 0.2s，敏感度 0.8

### 3. 性能优化

- 首次使用建议用短音频测试
- 关闭不必要的其他程序
- 定期清理 `data/temp/` 临时文件

---

## 📞 技术支持

- **问题反馈**: [GitHub Issues](https://github.com/yidong-liu/geyan-suidong-/issues)
- **文档更新**: 查看 `docs/` 目录
- **API文档**: http://localhost:8000/docs

---

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](../LICENSE) 了解详情

---

**版本**: v1.0.0  
**更新日期**: 2024-12  
**作者**: [@yidong-liu](https://github.com/yidong-liu)

🎵✨ 让每一首歌都有生动的表情！
