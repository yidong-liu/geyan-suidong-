(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();const re=class re{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?re.DefaultSize:this._capacity*2),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let r=0;r<t;r++)this._ptr[r]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let a=this._size;a<t;a++)typeof e=="function"?this._ptr[a]=JSON.parse(JSON.stringify(new e)):this._ptr[a]=e;else for(let a=this._size;a<t;a++)this._ptr[a]=e;else{const a=this._size-t;this._ptr.splice(this._size-a,a)}this._size=t}insert(t,e,i){let r=t._index;const a=e._index,n=i._index,o=n-a;this.prepareCapacity(this._size+o);const l=this._size-r;if(l>0)for(let h=0;h<l;h++)this._ptr.splice(r+h,0,null);for(let h=a;h<n;h++,r++)this._ptr[r]=e._vector._ptr[h];this._size=this._size+o}remove(t){return t<0||this._size<=t?!1:(this._ptr.splice(t,1),--this._size,!0)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new Re(this,e))}prepareCapacity(t){t>this._capacity&&(this._capacity==0?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return this._size==0?this.end():new Re(this,0)}end(){return new Re(this,this._size)}getOffset(t){const e=new re;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}};re.DefaultSize=10;let P=re,Re=class gi{constructor(t,e){this._vector=t??null,this._index=e??0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new gi(this._vector,this._index++)}decrement(){return new gi(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}};var zi;(s=>{s.csmVector=P,s.iterator=Re})(zi||(zi={}));class K{append(t,e){return this.s+=e!==void 0?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return this.s.length==0}constructor(t){this.s=t}}var Xi;(s=>{s.csmString=K})(Xi||(Xi={}));class Ht{static createIdInternal(t){return new Ht(t)}getString(){return this._id}isEqual(t){return typeof t=="string"?this._id.isEqual(t):t instanceof K?this._id.isEqual(t.s):t instanceof Ht?this._id.isEqual(t._id.s):!1}isNotEqual(t){return typeof t=="string"?!this._id.isEqual(t):t instanceof K?!this._id.isEqual(t.s):t instanceof Ht?!this._id.isEqual(t._id.s):!1}constructor(t){if(typeof t=="string"){this._id=new K(t);return}this._id=t}}var ji;(s=>{s.CubismId=Ht})(ji||(ji={}));class Mr{constructor(){this._ids=new P}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;if(typeof t=="string"){if((e=this.findId(t))!=null)return e;e=Ht.createIdInternal(t),this._ids.pushBack(e)}else return this.registerId(t.s);return e}getId(t){return this.registerId(t)}isExist(t){return typeof t=="string"?this.findId(t)!=null:this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}var Yi;(s=>{s.CubismIdManager=Mr})(Yi||(Yi={}));class k{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a=4;for(let n=0;n<a;++n)for(let o=0;o<a;++o)for(let l=0;l<a;++l)r[o+n*4]+=t[l+n*4]*e[o+l*4];for(let n=0;n<16;++n)i[n]=r[n]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);k.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);k.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){k.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new k;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}var Hi;(s=>{s.CubismMatrix44=k})(Hi||(Hi={}));class Ae{constructor(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}var $i;(s=>{s.csmRect=Ae})($i||($i={}));class Xe{static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,r){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._modelColor.r=t,this._modelColor.g=e,this._modelColor.b=i,this._modelColor.a=r}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}getModelColorWithOpacity(t){const e=this.getModelColor();return e.a*=t,this.isPremultipliedAlpha()&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new j,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new k,this._mvpMatrix4x4.loadIdentity()}}var bt=(s=>(s[s.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",s[s.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",s[s.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",s))(bt||{});class j{constructor(t=1,e=1,i=1,r=1){this.r=t,this.g=e,this.b=i,this.a=r}}class Ea{constructor(t,e){this._clippingIdList=t,this._clippingIdCount=e,this._allClippedDrawRect=new Ae,this._layoutBounds=new Ae,this._clippedDrawableIndexList=[],this._matrixForMask=new k,this._matrixForDraw=new k,this._bufferIndex=0}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}}var Gi;(s=>{s.CubismBlendMode=bt,s.CubismRenderer=Xe,s.CubismTextureColor=j})(Gi||(Gi={}));const Ta=(s,t,e)=>{Mi.print(s,"[CSM]"+t,e)},Ce=(s,t,e)=>{Ta(s,t+`
`,e)},st=s=>{console.assert(s)};let oe,J,xt,F;oe=(s,...t)=>{Ce(Et.LogLevel_Debug,"[D]"+s,t)},J=(s,...t)=>{Ce(Et.LogLevel_Info,"[I]"+s,t)},xt=(s,...t)=>{Ce(Et.LogLevel_Warning,"[W]"+s,t)},F=(s,...t)=>{Ce(Et.LogLevel_Error,"[E]"+s,t)};class Mi{static print(t,e,i){if(t<E.getLoggingLevel())return;const r=E.coreLogFunction;if(!r)return;const a=e.replace(/\{(\d+)\}/g,(n,o)=>i[o]);r(a)}static dumpBytes(t,e,i){for(let r=0;r<i;r++)r%16==0&&r>0?this.print(t,`
`):r%8==0&&r>0&&this.print(t,"  "),this.print(t,"{0} ",[e[r]&255]);this.print(t,`
`)}constructor(){}}var qi;(s=>{s.CubismDebug=Mi})(qi||(qi={}));class wr{constructor(t,e){this.first=t??null,this.second=e??null}}const ae=class ae{constructor(t){t!=null?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new wr(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let r=0;r<this._size;r++)if(this._keyValues[r].first==t){i=r;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(this._keyValues.length==0?(!e&&t<ae.DefaultSize&&(t=ae.DefaultSize),this._keyValues.length=t):(!e&&t<this._keyValues.length*2&&(t=this._keyValues.length*2),this._keyValues.length=t))}begin(){return new Ee(this,0)}end(){return new Ee(this,this._size)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new Ee(this,e))}dumpAsInt(){for(let t=0;t<this._size;t++)oe("{0} ,",this._keyValues[t]),oe(`
`)}};ae.DefaultSize=10;let q=ae,Ee=class di{constructor(t,e){this._map=t??new q,this._index=e??0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new di(this._map,this._index++)}decrement(){const t=new di(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}};var Wi;(s=>{s.csmMap=q,s.csmPair=wr,s.iterator=Ee})(Wi||(Wi={}));class De{static parseJsonObject(t,e){return Object.keys(t).forEach(i=>{if(typeof t[i]=="boolean"){const r=!!t[i];e.put(i,new it(r))}else if(typeof t[i]=="string"){const r=String(t[i]);e.put(i,new qt(r))}else if(typeof t[i]=="number"){const r=Number(t[i]);e.put(i,new Oe(r))}else t[i]instanceof Array?e.put(i,De.parseJsonArray(t[i])):t[i]instanceof Object?e.put(i,De.parseJsonObject(t[i],new Gt)):t[i]==null?e.put(i,new $t):e.put(i,t[i])}),e}static parseJsonArray(t){const e=new wi;return Object.keys(t).forEach(i=>{if(typeof Number(i)=="number")if(typeof t[i]=="boolean"){const a=!!t[i];e.add(new it(a))}else if(typeof t[i]=="string"){const a=String(t[i]);e.add(new qt(a))}else if(typeof t[i]=="number"){const a=Number(t[i]);e.add(new Oe(a))}else t[i]instanceof Array?e.add(this.parseJsonArray(t[i])):t[i]instanceof Object?e.add(this.parseJsonObject(t[i],new Gt)):t[i]==null?e.add(new $t):e.add(t[i]);else if(t[i]instanceof Array)e.add(this.parseJsonArray(t[i]));else if(t[i]instanceof Object)e.add(this.parseJsonObject(t[i],new Gt));else if(t[i]==null)e.add(new $t);else{const a=Array(t[i]);for(let n=0;n<a.length;n++)e.add(a[n])}}),e}}const Le="Error: type mismatch",Va="Error: index out of bounds";let U=class ut{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new P){return t}getMap(t){return t}getValueByIndex(t){return ut.errorValue.setErrorNotForClientCall(Le)}getValueByString(t){return ut.nullValue.setErrorNotForClientCall(Le)}getKeys(){return ut.dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return le.errorValue}static staticInitializeNotForClientCall(){it.trueValue=new it(!0),it.falseValue=new it(!1),ut.errorValue=new le("ERROR",!0),ut.nullValue=new $t,ut.dummyKeys=new P}static staticReleaseNotForClientCall(){it.trueValue=null,it.falseValue=null,ut.errorValue=null,ut.nullValue=null,ut.dummyKeys=null}};class N{constructor(t,e){this._parseCallback=De.parseJsonObject,this._error=null,this._lineCount=0,this._root=null,t!=null&&this.parseBytes(t,e,this._parseCallback)}static create(t,e){const i=new N;return i.parseBytes(t,e,i._parseCallback)?i:(N.delete(i),null)}static delete(t){}getRoot(){return this._root}static arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let r=0,a=e.length;r<a;++r)i+="%"+this.pad(e[r].toString(16));return i=decodeURIComponent(i),i}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,e,i){const r=new Array(1),a=N.arrayBufferToString(t);if(i==null?this._root=this.parseValue(a,e,0,r):this._root=i(JSON.parse(a),new Gt),this._error){let n="\0";return n="Json parse error : @line "+(this._lineCount+1)+`
`,this._root=new qt(n),J("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new le(new K(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,r){if(this._error)return null;let a=null,n=i,o;for(;n<e;n++)switch(t[n]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const h=new Array(1);return o=Fa(t.slice(n),h),r[0]=t.indexOf(h[0]),new Oe(o)}case'"':return new qt(this.parseString(t,e,n+1,r));case"[":return a=this.parseArray(t,e,n+1,r),a;case"{":return a=this.parseObject(t,e,n+1,r),a;case"n":return n+3<e?(a=new $t,r[0]=n+4):this._error="parse null",a;case"t":return n+3<e?(a=it.trueValue,r[0]=n+4):this._error="parse true",a;case"f":return n+4<e?(a=it.falseValue,r[0]=n+5):this._error="illegal ',' position",a;case",":return this._error="illegal ',' position",null;case"]":return r[0]=n,null;case`
`:this._lineCount++}return this._error="illegal end of value",null}parseString(t,e,i,r){if(this._error)return null;if(!t)return this._error="string is null",null;let a=i,n,o;const l=new K("");let h=i;for(;a<e;a++)switch(n=t[a],n){case'"':return r[0]=a+1,l.append(t.slice(h),a-h),l.s;case"//":if(a++,a-1>h&&l.append(t.slice(h),a-h),h=a+1,a<e)switch(o=t[a],o){case"\\":l.expansion(1,"\\");break;case'"':l.expansion(1,'"');break;case"/":l.expansion(1,"/");break;case"b":l.expansion(1,"\b");break;case"f":l.expansion(1,"\f");break;case"n":l.expansion(1,`
`);break;case"r":l.expansion(1,"\r");break;case"t":l.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,r){if(this._error)return null;if(!t)return this._error="buffer is null",null;const a=new Gt;let n="",o=i,l="";const h=Array(1);let u=!1;for(;o<e;o++){t:for(;o<e;o++)switch(l=t[o],l){case'"':if(n=this.parseString(t,e,o+1,h),this._error)return null;o=h[0],u=!0;break t;case"}":return r[0]=o+1,a;case":":this._error="illegal ':' position";break;case`
`:this._lineCount++}if(!u)return this._error="key not found",null;u=!1;t:for(;o<e;o++)switch(l=t[o],l){case":":u=!0,o++;break t;case"}":this._error="illegal '}' position";break;case`
`:this._lineCount++}if(!u)return this._error="':' not found",null;const g=this.parseValue(t,e,o,h);if(this._error)return null;o=h[0],a.put(n,g);t:for(;o<e;o++)switch(l=t[o],l){case",":break t;case"}":return r[0]=o+1,a;case`
`:this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,r){if(this._error)return null;if(!t)return this._error="buffer is null",null;let a=new wi,n=i,o;const l=new Array(1);for(;n<e;n++){const h=this.parseValue(t,e,n,l);if(this._error)return null;n=l[0],h&&a.add(h);t:for(;n<e;n++)switch(o=t[n],o){case",":break t;case"]":return r[0]=n+1,a;case`
`:++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}class Oe extends U{constructor(t){super(),this._value=t}isFloat(){return!0}getString(t,e){const i="\0";return this._value=parseFloat(i),this._stringBuffer=i,this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return typeof t=="number"?Math.round(t)?!1:t==this._value:!1}}class it extends U{isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return typeof t=="boolean"?t==this._boolValue:!1}isStatic(){return!0}constructor(t){super(),this._boolValue=t}}class qt extends U{constructor(t){super(),typeof t=="string"&&(this._stringBuffer=t),t instanceof K&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return typeof t=="string"?this._stringBuffer==t:t instanceof K?this._stringBuffer==t.s:!1}}class le extends qt{isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}constructor(t,e){typeof t=="string"?super(t):super(t),this._isStatic=e}isError(){return!0}}class $t extends U{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,le.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class wi extends U{constructor(){super(),this._array=new P}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return U.errorValue.setErrorNotForClientCall(Va);const e=this._array.at(t);return e??U.nullValue}getValueByString(t){return U.errorValue.setErrorNotForClientCall(Le)}getString(t,e){const i=e+`[
`;for(let r=this._array.begin();r.notEqual(this._array.end());r.increment()){const a=r.ptr();this._stringBuffer+=e+""+a.getString(e+" ")+`
`}return this._stringBuffer=i+e+`]
`,this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class Gt extends U{constructor(){super(),this._map=new q}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof K){const e=this._map.getValue(t.s);return e??U.nullValue}for(let e=this._map.begin();e.notEqual(this._map.end());e.preIncrement())if(e.ptr().first==t)return e.ptr().second==null?U.nullValue:e.ptr().second;return U.nullValue}getValueByIndex(t){return U.errorValue.setErrorNotForClientCall(Le)}getString(t,e){this._stringBuffer=e+`{
`;const i=this._map.begin();for(;i.notEqual(this._map.end());){const r=i.ptr().first,a=i.ptr().second;this._stringBuffer+=e+" "+r+" : "+a.getString(e+"   ")+` 
`,i.preIncrement()}return this._stringBuffer+=e+`}
`,this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new P;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var Ji;(s=>{s.CubismJson=N,s.JsonArray=wi,s.JsonBoolean=it,s.JsonError=le,s.JsonFloat=Oe,s.JsonMap=Gt,s.JsonNullvalue=$t,s.JsonString=qt,s.Value=U})(Ji||(Ji={}));function Fa(s,t){let e=0;for(let r=1;;r++){const a=s.slice(r-1,r);if(a=="e"||a=="-"||a=="E")continue;const n=s.substring(0,r),o=Number(n);if(isNaN(o))break;e=r}let i=parseFloat(s);return isNaN(i)&&(i=NaN),t[0]=s.slice(e),i}let Q=!1,Lt=!1,Ot=null,Qt=null;const Ct=Object.freeze({vertexOffset:0,vertexStep:2});function se(s){s&&(s=void 0)}class E{static startUp(t=null){if(Q)return J("CubismFramework.startUp() is already done."),Q;if(Ot=t,Ot!=null&&Live2DCubismCore.Logging.csmSetLogFunction(Ot.logFunction),Q=!0,Q){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,r=(e&16711680)>>16,a=e&65535,n=e;J("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+r).slice(-2),("0000"+a).slice(-4),n)}return J("CubismFramework.startUp() is complete."),Q}static cleanUp(){Q=!1,Lt=!1,Ot=null,Qt=null}static initialize(t=0){if(st(Q),!Q){xt("CubismFramework is not started.");return}if(Lt){xt("CubismFramework.initialize() skipped, already initialized.");return}U.staticInitializeNotForClientCall(),Qt=new Mr,Live2DCubismCore.Memory.initializeAmountOfMemory(t),Lt=!0,J("CubismFramework.initialize() is complete.")}static dispose(){if(st(Q),!Q){xt("CubismFramework is not started.");return}if(!Lt){xt("CubismFramework.dispose() skipped, not initialized.");return}U.staticReleaseNotForClientCall(),Qt.release(),Qt=null,Xe.staticRelease(),Lt=!1,J("CubismFramework.dispose() is complete.")}static isStarted(){return Q}static isInitialized(){return Lt}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return Ot!=null?Ot.loggingLevel:5}static getIdManager(){return Qt}constructor(){}}class Aa{}var Et=(s=>(s[s.LogLevel_Verbose=0]="LogLevel_Verbose",s[s.LogLevel_Debug=1]="LogLevel_Debug",s[s.LogLevel_Info=2]="LogLevel_Info",s[s.LogLevel_Warning=3]="LogLevel_Warning",s[s.LogLevel_Error=4]="LogLevel_Error",s[s.LogLevel_Off=5]="LogLevel_Off",s))(Et||{}),Ki;(s=>{s.Constant=Ct,s.csmDelete=se,s.CubismFramework=E})(Ki||(Ki={}));var Da="./model/";const Zi=1,La=2,Oa=.8,ka=-1,Na=1,Ua=-2,za=2,Xa=-2,ja=2,Br=Da,Ya="",Ha="",_i=["march_7"],$a=_i.length,Ga="Idle",qa="TapBody",Qi="Head",ts="Body",Wa=1,Ja=2,Ke=3,Ka=Et.LogLevel_Verbose;let L=null,y=null,kt=null;class Bi{static getInstance(){return kt==null&&(kt=new Bi),kt}static releaseInstance(){kt!=null&&kt.release(),kt=null}constructor(){L=document.getElementById("live2d"),y=L.getContext("webgl2"),y||(alert("无法初始化WebGL。此浏览器不支持。"),y=null,document.body.innerHTML="此浏览器不支持<code>&lt；画布&gt</代码>元素。")}release(){}}const b=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});var es;(s=>{s.HitAreaBody=b.HitAreaBody,s.HitAreaHead=b.HitAreaHead,s.HitAreaPrefix=b.HitAreaPrefix,s.ParamAngleX=b.ParamAngleX,s.ParamAngleY=b.ParamAngleY,s.ParamAngleZ=b.ParamAngleZ,s.ParamArmLA=b.ParamArmLA,s.ParamArmLB=b.ParamArmLB,s.ParamArmRA=b.ParamArmRA,s.ParamArmRB=b.ParamArmRB,s.ParamBaseX=b.ParamBaseX,s.ParamBaseY=b.ParamBaseY,s.ParamBodyAngleX=b.ParamBodyAngleX,s.ParamBodyAngleY=b.ParamBodyAngleY,s.ParamBodyAngleZ=b.ParamBodyAngleZ,s.ParamBreath=b.ParamBreath,s.ParamBrowLAngle=b.ParamBrowLAngle,s.ParamBrowLForm=b.ParamBrowLForm,s.ParamBrowLX=b.ParamBrowLX,s.ParamBrowLY=b.ParamBrowLY,s.ParamBrowRAngle=b.ParamBrowRAngle,s.ParamBrowRForm=b.ParamBrowRForm,s.ParamBrowRX=b.ParamBrowRX,s.ParamBrowRY=b.ParamBrowRY,s.ParamBustX=b.ParamBustX,s.ParamBustY=b.ParamBustY,s.ParamCheek=b.ParamCheek,s.ParamEyeBallForm=b.ParamEyeBallForm,s.ParamEyeBallX=b.ParamEyeBallX,s.ParamEyeBallY=b.ParamEyeBallY,s.ParamEyeLOpen=b.ParamEyeLOpen,s.ParamEyeLSmile=b.ParamEyeLSmile,s.ParamEyeROpen=b.ParamEyeROpen,s.ParamEyeRSmile=b.ParamEyeRSmile,s.ParamHairBack=b.ParamHairBack,s.ParamHairFluffy=b.ParamHairFluffy,s.ParamHairFront=b.ParamHairFront,s.ParamHairSide=b.ParamHairSide,s.ParamHandL=b.ParamHandL,s.ParamHandR=b.ParamHandR,s.ParamMouthForm=b.ParamMouthForm,s.ParamMouthOpenY=b.ParamMouthOpenY,s.ParamNONE=b.ParamNONE,s.ParamShoulderY=b.ParamShoulderY,s.PartsArmLPrefix=b.PartsArmLPrefix,s.PartsArmPrefix=b.PartsArmPrefix,s.PartsArmRPrefix=b.PartsArmRPrefix,s.PartsIdCore=b.PartsIdCore})(es||(es={}));class Ir{}var is;(s=>{s.ICubismModelSetting=Ir})(is||(is={}));const ft="FileReferences",Za="Groups",Qa="Layout",tn="HitAreas",en="Moc",sn="Textures",rn="Physics",an="Pose",nn="Expressions",on="Motions",ss="UserData",pt="Name",rs="File",ln="Id",Pe="Ids",as="Sound",ns="FadeInTime",os="FadeOutTime",Ze="LipSync",Qe="EyeBlink";class vr extends Ir{constructor(t,e){super(),this._json=N.create(t,e),this.getJson()&&(this._jsonValue=new P,this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(Za)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ft).getValueByString(en)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ft).getValueByString(on)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ft).getValueByString(nn)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ft).getValueByString(sn)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ft).getValueByString(rn)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ft).getValueByString(an)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(tn)))}release(){N.delete(this._json),this._jsonValue=null}getJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){const e=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),i=e.length-1;let r="";for(let a=0;a<i;a++)r+=e[a],a<i-1&&(r+="/");return r}getTextureFileName(t){return this._jsonValue.at(4).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(t){return E.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(t).getValueByString(ln).getRawString())}getHitAreaName(t){return this._jsonValue.at(7).getValueByIndex(t).getValueByString(pt).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(pt).getRawString()}getExpressionFileName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(rs).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(rs).getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(as).getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(ns).toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(os).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this.getJson().getRoot().getValueByString(ft).getValueByString(ss).getRawString():""}getLayoutMap(t){const e=this.getJson().getRoot().getValueByString(Qa).getMap();if(e==null)return!1;let i=!1;for(const r=e.begin();r.notEqual(e.end());r.preIncrement())t.setValue(r.ptr().first,r.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(pt).getRawString()==Qe){t=i.getValueByString(Pe).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(pt).getRawString()==Qe)return E.getIdManager().getId(i.getValueByString(Pe).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(pt).getRawString()==Ze){t=i.getValueByString(Pe).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(pt).getRawString()==Ze)return E.getIdManager().getId(i.getValueByString(Pe).getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(1);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(4);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(7);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(5);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(6);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(3);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(2);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(2).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(as);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(ns);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(os);return!i.isNull()&&!i.isError()}isExistUserDataFile(){const t=this.getJson().getRoot().getValueByString(ft).getValueByString(ss);return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(pt).getRawString()==Qe)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(pt).getRawString()==Ze)return!0;return!1}}var ls;(s=>{s.CubismModelSettingJson=vr})(ls||(ls={}));class _e{static create(){return new _e}static delete(t){}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*3.14159;for(let r=0;r<this._breathParameters.getSize();++r){const a=this._breathParameters.at(r);t.addParameterValueById(a.parameterId,a.offset+a.peak*Math.sin(i/a.cycle),a.weight)}}constructor(){this._currentTime=0}}class Xt{constructor(t,e,i,r,a){this.parameterId=t??null,this.offset=e??0,this.peak=i??0,this.cycle=r??0,this.weight=a??0}}var us;(s=>{s.BreathParameterData=Xt,s.CubismBreath=_e})(us||(us={}));const ne=class ne{static create(t=null){return new ne(t)}static delete(t){}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){this._userTimeSeconds+=e;let i,r=0;switch(this._blinkingState){case 2:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,r>=1&&(r=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-r;break;case 3:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,r>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,r>=1&&(r=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=r;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1;break}ne.CloseIfZero||(i=-i);for(let n=0;n<this._parameterIds.getSize();++n)t.setParameterValueById(this._parameterIds.at(n),i)}constructor(t){if(this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new P,t!=null)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};ne.CloseIfZero=!0;let ue=ne;var Rr=(s=>(s[s.EyeState_First=0]="EyeState_First",s[s.EyeState_Interval=1]="EyeState_Interval",s[s.EyeState_Closing=2]="EyeState_Closing",s[s.EyeState_Closed=3]="EyeState_Closed",s[s.EyeState_Opening=4]="EyeState_Opening",s))(Rr||{}),hs;(s=>{s.CubismEyeBlink=ue,s.EyeState=Rr})(hs||(hs={}));const un=.001,ti=.5,cs="FadeInTime",gs="Link",hn="Groups",cn="Id";class he{static create(t,e){const i=N.create(t,e);if(!i)return null;const r=new he,a=i.getRoot();a.getValueByString(cs).isNull()||(r._fadeTimeSeconds=a.getValueByString(cs).toFloat(ti),r._fadeTimeSeconds<=0&&(r._fadeTimeSeconds=ti));const n=a.getValueByString(hn),o=n.getSize();for(let l=0;l<o;++l){const h=n.getValueByIndex(l),u=h.getSize();let g=0;for(let f=0;f<u;++f){const d=h.getValueByIndex(f),c=new ce,p=E.getIdManager().getId(d.getValueByString(cn).getRawString());if(c.partId=p,!d.getValueByString(gs).isNull()){const _=d.getValueByString(gs),S=_.getSize();for(let x=0;x<S;++x){const C=new ce,w=E.getIdManager().getId(_.getValueByIndex(x).getString());C.partId=w,c.link.pushBack(C)}}r._partGroups.pushBack(c.clone()),++g}r._partGroupCounts.pushBack(g)}return N.delete(i),r}static delete(t){}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let r=0;r<this._partGroupCounts.getSize();r++){const a=this._partGroupCounts.at(r);this.doFade(t,e,i,a),i+=a}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const r=this._partGroupCounts.at(i);for(let a=e;a<e+r;++a){this._partGroups.at(a).initialize(t);const n=this._partGroups.at(a).partIndex,o=this._partGroups.at(a).parameterIndex;if(!(n<0)){t.setPartOpacityByIndex(n,a==e?1:0),t.setParameterValueByIndex(o,a==e?1:0);for(let l=0;l<this._partGroups.at(a).link.getSize();++l)this._partGroups.at(a).link.at(l).initialize(t)}}e+=r}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(i.link.getSize()==0)continue;const r=this._partGroups.at(e).partIndex,a=t.getPartOpacityByIndex(r);for(let n=0;n<i.link.getSize();++n){const l=i.link.at(n).partIndex;l<0||t.setPartOpacityByIndex(l,a)}}}doFade(t,e,i,r){let a=-1,n=1;const o=.5,l=.15;for(let h=i;h<i+r;++h){const u=this._partGroups.at(h).partIndex,g=this._partGroups.at(h).parameterIndex;if(t.getParameterValueByIndex(g)>un){if(a>=0)break;a=h,n=t.getPartOpacityByIndex(u),n+=e/this._fadeTimeSeconds,n>1&&(n=1)}}a<0&&(a=0,n=1);for(let h=i;h<i+r;++h){const u=this._partGroups.at(h).partIndex;if(a==h)t.setPartOpacityByIndex(u,n);else{let g=t.getPartOpacityByIndex(u),f;n<o?f=n*(o-1)/o+1:f=(1-n)*o/(1-o),(1-f)*(1-n)>l&&(f=1-l/(1-n)),g>f&&(g=f),t.setPartOpacityByIndex(u,g)}}}constructor(){this._fadeTimeSeconds=ti,this._lastModel=null,this._partGroups=new P,this._partGroupCounts=new P}}class ce{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new P,t!=null){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new ce;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new P;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}var ds;(s=>{s.CubismPose=he,s.PartData=ce})(ds||(ds={}));class Er extends k{constructor(t,e){super(),this._width=t!==void 0?t:0,this._height=e!==void 0?e:0,this.setHeight(2)}setWidth(t){const e=t/this._width,i=e;this.scale(e,i)}setHeight(t){const e=t/this._height,i=e;this.scale(e,i)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){const e="width",i="height",r="x",a="y",n="center_x",o="center_y",l="top",h="bottom",u="left",g="right";for(const f=t.begin();f.notEqual(t.end());f.preIncrement()){const d=f.ptr().first,c=f.ptr().second;d==e?this.setWidth(c):d==i&&this.setHeight(c)}for(const f=t.begin();f.notEqual(t.end());f.preIncrement()){const d=f.ptr().first,c=f.ptr().second;d==r?this.setX(c):d==a?this.setY(c):d==n?this.centerX(c):d==o?this.centerY(c):d==l?this.top(c):d==h?this.bottom(c):d==u?this.left(c):d==g&&this.right(c)}}}var _s;(s=>{s.CubismModelMatrix=Er})(_s||(_s={}));class M{constructor(t,e){this.x=t,this.y=e,this.x=t??0,this.y=e??0}add(t){const e=new M(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new M(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new M(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new M(t,t))}division(t){const e=new M(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new M(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}var ms;(s=>{s.CubismVector2=M})(ms||(ms={}));const jt=class jt{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let e=t;const i=e<0;i&&(e=-e);let r;return e===1/0?r=1/0:(r=Math.exp(Math.log(e)/3),r=(e/(r*r)+2*r)/3),i?-r:r}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,e){const i=Math.atan2(e.y,e.x),r=Math.atan2(t.y,t.x);let a=i-r;for(;a<-Math.PI;)a+=Math.PI*2;for(;a>Math.PI;)a-=Math.PI*2;return a}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let r=this.radianToDegrees(i);return e.x-t.x>0&&(r=-r),r}static radianToDirection(t){const e=new M;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<jt.Epsilon?this.abs(e)<jt.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,r){if(this.sqrt(t)<jt.Epsilon)return this.range(this.quadraticEquation(e,i,r),0,1);const a=e/t,n=i/t,o=r/t,l=(3*n-a*a)/3,h=l/3,u=(2*a*a*a-9*a*n+27*o)/27,g=u/2,f=g*g+h*h*h,d=.5,c=d+.01;if(f<0){const C=-l/3,w=C*C*C,B=this.sqrt(w),v=-u/(2*B),T=this.range(v,-1,1),X=Math.acos(T),ht=2*this.cbrt(B),ct=ht*this.cos(X/3)-a/3;if(this.abs(ct-d)<c)return this.range(ct,0,1);const nt=ht*this.cos((X+2*Math.PI)/3)-a/3;if(this.abs(nt-d)<c)return this.range(nt,0,1);const Mt=ht*this.cos((X+4*Math.PI)/3)-a/3;return this.range(Mt,0,1)}if(f==0){let C;g<0?C=this.cbrt(-g):C=-this.cbrt(g);const w=2*C-a/3;if(this.abs(w-d)<c)return this.range(w,0,1);const B=-C-a/3;return this.range(B,0,1)}const p=this.sqrt(f),_=this.cbrt(p-g),S=this.cbrt(p+g),x=_-S-a/3;return this.range(x,0,1)}static mod(t,e){if(!isFinite(t)||e===0||isNaN(t)||isNaN(e))return console.warn(`divided: ${t}, divisor: ${e} mod() returns 'NaN'.`),NaN;const i=Math.abs(t),r=Math.abs(e);let a=i-Math.floor(i/r)*r;return a*=Math.sign(t),a}constructor(){}};jt.Epsilon=1e-5;let I=jt;var fs;(s=>{s.CubismMath=I})(fs||(fs={}));const ei=30,ps=.01;class Tr{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const i=40/10*1/ei;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}const r=(this._userTimeSeconds-this._lastTimeSeconds)*ei;this._lastTimeSeconds=this._userTimeSeconds;const n=.15*ei,o=r*i/n,l=this._faceTargetX-this._faceX,h=this._faceTargetY-this._faceY;if(I.abs(l)<=ps&&I.abs(h)<=ps)return;const u=I.sqrt(l*l+h*h),g=i*l/u,f=i*h/u;let d=g-this._faceVX,c=f-this._faceVY;const p=I.sqrt(d*d+c*c);(p<-o||p>o)&&(d*=o/p,c*=o/p),this._faceVX+=d,this._faceVY+=c;{const _=.5*(I.sqrt(o*o+16*o*u-8*o*u)-o),S=I.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);S>_&&(this._faceVX*=_/S,this._faceVY*=_/S)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}var ys;(s=>{s.CubismTargetPoint=Tr})(ys||(ys={}));class Wt{constructor(){this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new P}static delete(t){t.release(),t=null}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;this.setupMotionQueueEntry(e,i);const r=this.updateFadeWeight(e,i);this.doUpdateParameters(t,i,r,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setupMotionQueueEntry(t,e){if(t==null||t.isStarted()||!t.isAvailable())return;t.setIsStarted(!0),t.setStartTime(e-this._offsetSeconds),t.setFadeInStartTime(e);const i=this.getDuration();t.getEndTime()<0&&t.setEndTime(i<=0?-1:t.getStartTime()+i)}updateFadeWeight(t,e){t==null&&Mi.print(Et.LogLevel_Error,"motionQueueEntry is null.");let i=this._weight;const r=this._fadeInSeconds==0?1:I.getEasingSine((e-t.getFadeInStartTime())/this._fadeInSeconds),a=this._fadeOutSeconds==0||t.getEndTime()<0?1:I.getEasingSine((t.getEndTime()-e)/this._fadeOutSeconds);return i=i*r*a,t.setState(e,i),st(0<=i&&i<=1),i}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){return null}getModelOpacityValue(){return 1}}var Ss;(s=>{s.ACubismMotion=Wt})(Ss||(Ss={}));const gn="FadeInTime",dn="FadeOutTime",xs="Parameters",_n="Id",mn="Value",be="Blend",fn="Add",pn="Multiply",yn="Overwrite",Cs=1,G=class G extends Wt{static create(t,e){const i=new G;return i.parse(t,e),i}doUpdateParameters(t,e,i,r){for(let a=0;a<this._parameters.getSize();++a){const n=this._parameters.at(a);switch(n.blendType){case 0:{t.addParameterValueById(n.parameterId,n.value,i);break}case 1:{t.multiplyParameterValueById(n.parameterId,n.value,i);break}case 2:{t.setParameterValueById(n.parameterId,n.value,i);break}}}}calculateExpressionParameters(t,e,i,r,a,n){if(!(i==null||r==null)&&i.isAvailable()){this._fadeWeight=this.updateFadeWeight(i,e);for(let o=0;o<r.getSize();++o){const l=r.at(o);if(l.parameterId==null)continue;const h=l.overwriteValue=t.getParameterValueById(l.parameterId),u=this.getExpressionParameters();let g=-1;for(let _=0;_<u.getSize();++_)if(l.parameterId==u.at(_).parameterId){g=_;break}if(g<0){a==0?(l.additiveValue=G.DefaultAdditiveValue,l.multiplyValue=G.DefaultMultiplyValue,l.overwriteValue=h):(l.additiveValue=this.calculateValue(l.additiveValue,G.DefaultAdditiveValue,n),l.multiplyValue=this.calculateValue(l.multiplyValue,G.DefaultMultiplyValue,n),l.overwriteValue=this.calculateValue(l.overwriteValue,h,n));continue}const f=u.at(g).value;let d,c,p;switch(u.at(g).blendType){case 0:d=f,c=G.DefaultMultiplyValue,p=h;break;case 1:d=G.DefaultAdditiveValue,c=f,p=h;break;case 2:d=G.DefaultAdditiveValue,c=G.DefaultMultiplyValue,p=f;break;default:return}a==0?(l.additiveValue=d,l.multiplyValue=c,l.overwriteValue=p):(l.additiveValue=l.additiveValue*(1-n)+d*n,l.multiplyValue=l.multiplyValue*(1-n)+c*n,l.overwriteValue=l.overwriteValue*(1-n)+p*n)}}}getExpressionParameters(){return this._parameters}getFadeWeight(){return this._fadeWeight}parse(t,e){const i=N.create(t,e);if(!i)return;const r=i.getRoot();this.setFadeInTime(r.getValueByString(gn).toFloat(Cs)),this.setFadeOutTime(r.getValueByString(dn).toFloat(Cs));const a=r.getValueByString(xs).getSize();this._parameters.prepareCapacity(a);for(let n=0;n<a;++n){const o=r.getValueByString(xs).getValueByIndex(n),l=E.getIdManager().getId(o.getValueByString(_n).getRawString()),h=o.getValueByString(mn).toFloat();let u;o.getValueByString(be).isNull()||o.getValueByString(be).getString()==fn?u=0:o.getValueByString(be).getString()==pn?u=1:o.getValueByString(be).getString()==yn?u=2:u=0;const g=new Fr;g.parameterId=l,g.blendType=u,g.value=h,this._parameters.pushBack(g)}N.delete(i)}calculateValue(t,e,i){return t*(1-i)+e*i}constructor(){super(),this._parameters=new P,this._fadeWeight=0}};G.DefaultAdditiveValue=0,G.DefaultMultiplyValue=1;let Pt=G;var Vr=(s=>(s[s.Additive=0]="Additive",s[s.Multiply=1]="Multiply",s[s.Overwrite=2]="Overwrite",s))(Vr||{});class Fr{}var Ps;(s=>{s.CubismExpressionMotion=Pt,s.ExpressionBlendType=Vr,s.ExpressionParameter=Fr})(Ps||(Ps={}));class mi{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&Wt.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}getCubismMotion(){return this._motion}}var bs;(s=>{s.CubismMotionQueueEntry=mi})(bs||(bs={}));class Ii{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new P}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,e,i){if(t==null)return ke;let r=null;for(let a=0;a<this._motions.getSize();++a)r=this._motions.at(a),r!=null&&r.setFadeOut(r._motion.getFadeOutTime());return r=new mi,r._autoDelete=e,r._motion=t,this._motions.pushBack(r),r._motionQueueEntryHandle}endMotion(t,e){let i=null;for(let r=0;r<this._motions.getSize();++r)i=this._motions.at(r),i!=null&&i.setFadeOut(i._motion.getFadeOutTime());i=new mi,i._autoDelete=e,i._motion=t,this._motions.pushBack(i)}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}if(e._motion==null){e.release(),e=null,t=this._motions.erase(t);continue}if(e.isFinished())t.preIncrement();else return!1}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e&&e._motion){t=this._motions.erase(t);continue}e.release(),e=null,t=this._motions.erase(t)}}getCubismMotionQueueEntries(){return this._motions}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let r=this._motions.begin();r.notEqual(this._motions.end());){let a=r.ptr();if(a==null){r=this._motions.erase(r);continue}const n=a._motion;if(n==null){a.release(),a=null,r=this._motions.erase(r);continue}n.updateParameters(t,a,e),i=!0;const o=n.getFiredEvent(a.getLastCheckEventSeconds()-a.getStartTime(),e-a.getStartTime());for(let l=0;l<o.getSize();++l)this._eventCallBack(this,o.at(l),this._eventCustomData);a.setLastCheckEventSeconds(e),a.isFinished()?(a.release(),a=null,r=this._motions.erase(r)):(a.isTriggeredFadeOut()&&a.startFadeOut(a.getFadeOutSeconds(),e),r.preIncrement())}return i}}const ke=-1;var Ms;(s=>{s.CubismMotionQueueManager=Ii,s.InvalidMotionQueueEntryHandleValue=ke})(Ms||(Ms={}));class Sn{}class Ar extends Ii{constructor(){super(),this._currentPriority=0,this._reservePriority=0,this._expressionParameterValues=new P,this._fadeWeights=new P}release(){this._expressionParameterValues&&(se(this._expressionParameterValues),this._expressionParameterValues=null),this._fadeWeights&&(se(this._fadeWeights),this._fadeWeights=null)}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}getFadeWeight(t){return this._fadeWeights.at(t)}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i,r){return i==this.getReservePriority()&&this.setReservePriority(0),this._currentPriority=i,this._fadeWeights.pushBack(0),this.startMotion(t,e,r)}updateMotion(t,e){this._userTimeSeconds+=e;let i=!1;const r=this.getCubismMotionQueueEntries();let a=0,n=0;for(let o=this._motions.begin();o.notEqual(this._motions.end());){const l=o.ptr();if(l==null){o=r.erase(o);continue}const h=l.getCubismMotion();if(h==null){se(l),o=r.erase(o);continue}const u=h.getExpressionParameters();if(l.isAvailable())for(let g=0;g<u.getSize();++g){if(u.at(g).parameterId==null)continue;let f=-1;for(let c=0;c<this._expressionParameterValues.getSize();++c)if(this._expressionParameterValues.at(c).parameterId==u.at(g).parameterId){f=c;break}if(f>=0)continue;const d=new Sn;d.parameterId=u.at(g).parameterId,d.additiveValue=Pt.DefaultAdditiveValue,d.multiplyValue=Pt.DefaultMultiplyValue,d.overwriteValue=t.getParameterValueById(d.parameterId),this._expressionParameterValues.pushBack(d)}h.setupMotionQueueEntry(l,this._userTimeSeconds),this._fadeWeights.set(n,h.updateFadeWeight(l,this._userTimeSeconds)),h.calculateExpressionParameters(t,this._userTimeSeconds,l,this._expressionParameterValues,n,this._fadeWeights.at(n)),a+=h.getFadeInTime()==0?1:I.getEasingSine((this._userTimeSeconds-l.getFadeInStartTime())/h.getFadeInTime()),i=!0,l.isTriggeredFadeOut()&&l.startFadeOut(l.getFadeOutSeconds(),this._userTimeSeconds),o.preIncrement(),++n}r.getSize()>1&&(r.at(r.getSize()-1).getCubismMotion(),this._fadeWeights.at(this._fadeWeights.getSize()-1)>=1&&setTimeout(()=>{for(let l=r.getSize()-2;l>=0;--l){const h=r.at(l);se(h),r.remove(l),this._fadeWeights.remove(l)}},2e3)),a>1&&(a=1);for(let o=0;o<this._expressionParameterValues.getSize();++o){const l=this._expressionParameterValues.at(o);t.setParameterValueById(l.parameterId,(l.overwriteValue+l.additiveValue)*l.multiplyValue,a),l.additiveValue=Pt.DefaultAdditiveValue,l.multiplyValue=Pt.DefaultMultiplyValue}return i}}var ws;(s=>{s.CubismExpressionMotionManager=Ar})(ws||(ws={}));var tt=(s=>(s[s.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",s[s.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",s[s.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",s))(tt||{}),et=(s=>(s[s.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",s[s.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",s[s.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",s[s.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",s))(et||{});class vi{constructor(){this.time=0,this.value=0}}class Dr{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class Lr{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class Or{constructor(){this.fireTime=0}}class kr{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new P,this.segments=new P,this.points=new P,this.events=new P}}var Bs;(s=>{s.CubismMotionCurve=Lr,s.CubismMotionCurveTarget=tt,s.CubismMotionData=kr,s.CubismMotionEvent=Or,s.CubismMotionPoint=vi,s.CubismMotionSegment=Dr,s.CubismMotionSegmentType=et})(Bs||(Bs={}));const $="Meta",xn="Duration",Cn="Loop",Pn="AreBeziersRestricted",bn="CurveCount",Mn="Fps",wn="TotalSegmentCount",Bn="TotalPointCount",yt="Curves",In="Target",vn="Id",Me="FadeInTime",we="FadeOutTime",Is="Segments",vs="UserData",Rn="UserDataCount",En="TotalUserDataSize",Tn="Time",Vn="Value";class Nr{constructor(t,e){this._json=N.create(t,e)}release(){N.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString($).getValueByString(xn).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString($).getValueByString(Cn).toBoolean()}getEvaluationOptionFlag(t){return t==0?this._json.getRoot().getValueByString($).getValueByString(Pn).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString($).getValueByString(bn).toInt()}getMotionFps(){return this._json.getRoot().getValueByString($).getValueByString(Mn).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString($).getValueByString(wn).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString($).getValueByString(Bn).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString($).getValueByString(Me).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString($).getValueByString(we).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString($).getValueByString(Me).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString($).getValueByString(we).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(yt).getValueByIndex(t).getValueByString(In).getRawString()}getMotionCurveId(t){return E.getIdManager().getId(this._json.getRoot().getValueByString(yt).getValueByIndex(t).getValueByString(vn).getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(yt).getValueByIndex(t).getValueByString(Me).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(yt).getValueByIndex(t).getValueByString(we).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(yt).getValueByIndex(t).getValueByString(Me).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(yt).getValueByIndex(t).getValueByString(we).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(yt).getValueByIndex(t).getValueByString(Is).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(yt).getValueByIndex(t).getValueByString(Is).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString($).getValueByString(Rn).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString($).getValueByString(En).toInt()}getEventTime(t){return this._json.getRoot().getValueByString(vs).getValueByIndex(t).getValueByString(Tn).toFloat()}getEventValue(t){return new K(this._json.getRoot().getValueByString(vs).getValueByIndex(t).getValueByString(Vn).getRawString())}}var Ur=(s=>(s[s.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",s))(Ur||{}),Rs;(s=>{s.CubismMotionJson=Nr})(Rs||(Rs={}));const Fn="EyeBlink",An="LipSync",Dn="Model",Ln="Parameter",On="PartOpacity",Be="Opacity",kn=!1;function W(s,t,e){const i=new vi;return i.time=s.time+(t.time-s.time)*e,i.value=s.value+(t.value-s.value)*e,i}function Nn(s,t){let e=(t-s[0].time)/(s[1].time-s[0].time);return e<0&&(e=0),s[0].value+(s[1].value-s[0].value)*e}function Un(s,t){let e=(t-s[0].time)/(s[3].time-s[0].time);e<0&&(e=0);const i=W(s[0],s[1],e),r=W(s[1],s[2],e),a=W(s[2],s[3],e),n=W(i,r,e),o=W(r,a,e);return W(n,o,e).value}function zn(s,t){const e=t,i=s[0].time,r=s[3].time,a=s[1].time,n=s[2].time,o=r-3*n+3*a-i,l=3*n-6*a+3*i,h=3*a-3*i,u=i-e,g=I.cardanoAlgorithmForBezier(o,l,h,u),f=W(s[0],s[1],g),d=W(s[1],s[2],g),c=W(s[2],s[3],g),p=W(f,d,g),_=W(d,c,g);return W(p,_,g).value}function Xn(s,t){return s[0].value}function jn(s,t){return s[1].value}function ii(s,t,e){const i=s.curves.at(t);let r=-1;const a=i.baseSegmentIndex+i.segmentCount;let n=0;for(let l=i.baseSegmentIndex;l<a;++l)if(n=s.segments.at(l).basePointIndex+(s.segments.at(l).segmentType==et.CubismMotionSegmentType_Bezier?3:1),s.points.at(n).time>e){r=l;break}if(r==-1)return s.points.at(n).value;const o=s.segments.at(r);return o.evaluate(s.points.get(o.basePointIndex),e)}class je extends Wt{static create(t,e,i){const r=new je;return r.parse(t,e),r._sourceFrameRate=r._motionData.fps,r._loopDurationSeconds=r._motionData.duration,r._onFinishedMotion=i,r}doUpdateParameters(t,e,i,r){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=E.getIdManager().getId(Fn)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=E.getIdManager().getId(An)),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=E.getIdManager().getId(Be));let a=e-r.getStartTime();a<0&&(a=0);let n=Number.MAX_VALUE,o=Number.MAX_VALUE;const l=64;let h=0,u=0;this._eyeBlinkParameterIds.getSize()>l&&oe("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>l&&oe("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const g=this._fadeInSeconds<=0?1:I.getEasingSine((e-r.getFadeInStartTime())/this._fadeInSeconds),f=this._fadeOutSeconds<=0||r.getEndTime()<0?1:I.getEasingSine((r.getEndTime()-e)/this._fadeOutSeconds);let d,c,p,_=a;if(this._isLoop)for(;_>this._motionData.duration;)_-=this._motionData.duration;const S=this._motionData.curves;for(c=0;c<this._motionData.curveCount&&S.at(c).type==tt.CubismMotionCurveTarget_Model;++c)d=ii(this._motionData,c,_),S.at(c).id==this._modelCurveIdEyeBlink?o=d:S.at(c).id==this._modelCurveIdLipSync?n=d:S.at(c).id==this._modelCurveIdOpacity&&(this._modelOpacity=d,t.setModelOapcity(this.getModelOpacityValue()));for(;c<this._motionData.curveCount&&S.at(c).type==tt.CubismMotionCurveTarget_Parameter;++c){if(p=t.getParameterIndex(S.at(c).id),p==-1)continue;const x=t.getParameterValueByIndex(p);if(d=ii(this._motionData,c,_),o!=Number.MAX_VALUE){for(let w=0;w<this._eyeBlinkParameterIds.getSize()&&w<l;++w)if(this._eyeBlinkParameterIds.at(w)==S.at(c).id){d*=o,u|=1<<w;break}}if(n!=Number.MAX_VALUE){for(let w=0;w<this._lipSyncParameterIds.getSize()&&w<l;++w)if(this._lipSyncParameterIds.at(w)==S.at(c).id){d+=n,h|=1<<w;break}}let C;if(S.at(c).fadeInTime<0&&S.at(c).fadeOutTime<0)C=x+(d-x)*i;else{let w,B;S.at(c).fadeInTime<0?w=g:w=S.at(c).fadeInTime==0?1:I.getEasingSine((e-r.getFadeInStartTime())/S.at(c).fadeInTime),S.at(c).fadeOutTime<0?B=f:B=S.at(c).fadeOutTime==0||r.getEndTime()<0?1:I.getEasingSine((r.getEndTime()-e)/S.at(c).fadeOutTime);const v=this._weight*w*B;C=x+(d-x)*v}t.setParameterValueByIndex(p,C,1)}{if(o!=Number.MAX_VALUE)for(let x=0;x<this._eyeBlinkParameterIds.getSize()&&x<l;++x){const C=t.getParameterValueById(this._eyeBlinkParameterIds.at(x));if(u>>x&1)continue;const w=C+(o-C)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(x),w)}if(n!=Number.MAX_VALUE)for(let x=0;x<this._lipSyncParameterIds.getSize()&&x<l;++x){const C=t.getParameterValueById(this._lipSyncParameterIds.at(x));if(h>>x&1)continue;const w=C+(n-C)*i;t.setParameterValueById(this._lipSyncParameterIds.at(x),w)}}for(;c<this._motionData.curveCount&&S.at(c).type==tt.CubismMotionCurveTarget_PartOpacity;++c)p=t.getParameterIndex(S.at(c).id),p!=-1&&(d=ii(this._motionData,c,_),t.setParameterValueByIndex(p,d));a>=this._motionData.duration&&(this._isLoop?(r.setStartTime(e),this._isLoopFadeIn&&r.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),r.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id){i.at(r).fadeInTime=e;return}}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id){i.at(r).fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}constructor(){super(),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1}release(){this._motionData=void 0,this._motionData=null}parse(t,e){this._motionData=new kr;let i=new Nr(t,e);if(!i){i.release(),i=void 0;return}this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();const r=i.getEvaluationOptionFlag(Ur.EvaluationOptionFlag_AreBeziersRistricted);i.isExistMotionFadeInTime()?this._fadeInSeconds=i.getMotionFadeInTime()<0?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=i.getMotionFadeOutTime()<0?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,Lr,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),Dr,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),vi,!0),this._motionData.events.updateSize(this._motionData.eventCount,Or,!0);let a=0,n=0;for(let o=0;o<this._motionData.curveCount;++o){i.getMotionCurveTarget(o)==Dn?this._motionData.curves.at(o).type=tt.CubismMotionCurveTarget_Model:i.getMotionCurveTarget(o)==Ln?this._motionData.curves.at(o).type=tt.CubismMotionCurveTarget_Parameter:i.getMotionCurveTarget(o)==On?this._motionData.curves.at(o).type=tt.CubismMotionCurveTarget_PartOpacity:xt('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(o).id=i.getMotionCurveId(o),this._motionData.curves.at(o).baseSegmentIndex=n,this._motionData.curves.at(o).fadeInTime=i.isExistMotionCurveFadeInTime(o)?i.getMotionCurveFadeInTime(o):-1,this._motionData.curves.at(o).fadeOutTime=i.isExistMotionCurveFadeOutTime(o)?i.getMotionCurveFadeOutTime(o):-1;for(let l=0;l<i.getMotionCurveSegmentCount(o);){switch(l==0?(this._motionData.segments.at(n).basePointIndex=a,this._motionData.points.at(a).time=i.getMotionCurveSegment(o,l),this._motionData.points.at(a).value=i.getMotionCurveSegment(o,l+1),a+=1,l+=2):this._motionData.segments.at(n).basePointIndex=a-1,i.getMotionCurveSegment(o,l)){case et.CubismMotionSegmentType_Linear:{this._motionData.segments.at(n).segmentType=et.CubismMotionSegmentType_Linear,this._motionData.segments.at(n).evaluate=Nn,this._motionData.points.at(a).time=i.getMotionCurveSegment(o,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(o,l+2),a+=1,l+=3;break}case et.CubismMotionSegmentType_Bezier:{this._motionData.segments.at(n).segmentType=et.CubismMotionSegmentType_Bezier,r||kn?this._motionData.segments.at(n).evaluate=Un:this._motionData.segments.at(n).evaluate=zn,this._motionData.points.at(a).time=i.getMotionCurveSegment(o,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(o,l+2),this._motionData.points.at(a+1).time=i.getMotionCurveSegment(o,l+3),this._motionData.points.at(a+1).value=i.getMotionCurveSegment(o,l+4),this._motionData.points.at(a+2).time=i.getMotionCurveSegment(o,l+5),this._motionData.points.at(a+2).value=i.getMotionCurveSegment(o,l+6),a+=3,l+=7;break}case et.CubismMotionSegmentType_Stepped:{this._motionData.segments.at(n).segmentType=et.CubismMotionSegmentType_Stepped,this._motionData.segments.at(n).evaluate=Xn,this._motionData.points.at(a).time=i.getMotionCurveSegment(o,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(o,l+2),a+=1,l+=3;break}case et.CubismMotionSegmentType_InverseStepped:{this._motionData.segments.at(n).segmentType=et.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(n).evaluate=jn,this._motionData.points.at(a).time=i.getMotionCurveSegment(o,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(o,l+2),a+=1,l+=3;break}default:{st(0);break}}++this._motionData.curves.at(o).segmentCount,++n}}for(let o=0;o<i.getEventCount();++o)this._motionData.events.at(o).fireTime=i.getEventTime(o),this._motionData.events.at(o).value=i.getEventValue(o);i.release(),i=void 0,i=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new K(this._motionData.events.at(i).value.s));return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==tt.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(Be)==0)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==tt.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(Be)==0)return t}return-1}getModelOpacityId(t){if(t!=-1){const e=this._motionData.curves.at(t);if(e.type==tt.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(Be)==0)return E.getIdManager().getId(e.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}}var Es;(s=>{s.CubismMotion=je})(Es||(Es={}));class zr extends Ii{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(t,e)}updateMotion(t,e){this._userTimeSeconds+=e;const i=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(t){return t<=this._reservePriority||t<=this._currentPriority?!1:(this._reservePriority=t,!0)}}var Ts;(s=>{s.CubismMotionManager=zr})(Ts||(Ts={}));var Ne=(s=>(s[s.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",s))(Ne||{}),St=(s=>(s[s.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",s[s.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",s[s.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",s))(St||{});class Yn{constructor(){this.gravity=new M(0,0),this.wind=new M(0,0)}}class Ri{}class fi{}class Xr{constructor(){this.initialPosition=new M(0,0),this.position=new M(0,0),this.lastPosition=new M(0,0),this.lastGravity=new M(0,0),this.force=new M(0,0),this.velocity=new M(0,0)}}class jr{constructor(){this.normalizationPosition=new fi,this.normalizationAngle=new fi}}class Yr{constructor(){this.source=new Ri}}class Hr{constructor(){this.destination=new Ri,this.translationScale=new M(0,0)}}class $r{constructor(){this.settings=new P,this.inputs=new P,this.outputs=new P,this.particles=new P,this.gravity=new M(0,0),this.wind=new M(0,0),this.fps=0}}var Vs;(s=>{s.CubismPhysicsInput=Yr,s.CubismPhysicsNormalization=fi,s.CubismPhysicsOutput=Hr,s.CubismPhysicsParameter=Ri,s.CubismPhysicsParticle=Xr,s.CubismPhysicsRig=$r,s.CubismPhysicsSource=St,s.CubismPhysicsSubRig=jr,s.CubismPhysicsTargetType=Ne,s.PhysicsJsonEffectiveForces=Yn})(Vs||(Vs={}));const te="Position",si="X",ri="Y",ai="Angle",Fs="Type",As="Id",gt="Meta",Ie="EffectiveForces",Hn="TotalInputCount",$n="TotalOutputCount",Gn="PhysicsSettingCount",Ds="Gravity",Ls="Wind",qn="VertexCount",Wn="Fps",D="PhysicsSettings",Nt="Normalization",Os="Minimum",ks="Maximum",Ns="Default",Us="Reflect",zs="Weight",ee="Input",Jn="Source",Bt="Output",Kn="Scale",Zn="VertexIndex",Qn="Destination",It="Vertices",to="Mobility",eo="Delay",io="Radius",so="Acceleration";class Gr{constructor(t,e){this._json=N.create(t,e)}release(){N.delete(this._json)}getGravity(){const t=new M(0,0);return t.x=this._json.getRoot().getValueByString(gt).getValueByString(Ie).getValueByString(Ds).getValueByString(si).toFloat(),t.y=this._json.getRoot().getValueByString(gt).getValueByString(Ie).getValueByString(Ds).getValueByString(ri).toFloat(),t}getWind(){const t=new M(0,0);return t.x=this._json.getRoot().getValueByString(gt).getValueByString(Ie).getValueByString(Ls).getValueByString(si).toFloat(),t.y=this._json.getRoot().getValueByString(gt).getValueByString(Ie).getValueByString(Ls).getValueByString(ri).toFloat(),t}getFps(){return this._json.getRoot().getValueByString(gt).getValueByString(Wn).toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(gt).getValueByString(Gn).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(gt).getValueByString(Hn).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(gt).getValueByString($n).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(gt).getValueByString(qn).toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Nt).getValueByString(te).getValueByString(Os).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Nt).getValueByString(te).getValueByString(ks).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Nt).getValueByString(te).getValueByString(Ns).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Nt).getValueByString(ai).getValueByString(Os).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Nt).getValueByString(ai).getValueByString(ks).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Nt).getValueByString(ai).getValueByString(Ns).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(ee).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(ee).getValueByIndex(e).getValueByString(zs).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(ee).getValueByIndex(e).getValueByString(Us).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(ee).getValueByIndex(e).getValueByString(Fs).getRawString()}getInputSourceId(t,e){return E.getIdManager().getId(this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(ee).getValueByIndex(e).getValueByString(Jn).getValueByString(As).getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Bt).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Bt).getValueByIndex(e).getValueByString(Zn).toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Bt).getValueByIndex(e).getValueByString(Kn).toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Bt).getValueByIndex(e).getValueByString(zs).toFloat()}getOutputDestinationId(t,e){return E.getIdManager().getId(this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Bt).getValueByIndex(e).getValueByString(Qn).getValueByString(As).getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Bt).getValueByIndex(e).getValueByString(Fs).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(Bt).getValueByIndex(e).getValueByString(Us).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(It).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(It).getValueByIndex(e).getValueByString(to).toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(It).getValueByIndex(e).getValueByString(eo).toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(It).getValueByIndex(e).getValueByString(so).toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(It).getValueByIndex(e).getValueByString(io).toFloat()}getParticlePosition(t,e){const i=new M(0,0);return i.x=this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(It).getValueByIndex(e).getValueByString(te).getValueByString(si).toFloat(),i.y=this._json.getRoot().getValueByString(D).getValueByIndex(t).getValueByString(It).getValueByIndex(e).getValueByString(te).getValueByString(ri).toFloat(),i}}var Xs;(s=>{s.CubismPhysicsJson=Gr})(Xs||(Xs={}));const js="X",Ys="Y",Hs="Angle",ro=5,pi=100,$s=.001,ao=5;class ge{static create(t,e){const i=new ge;return i.parse(t,e),i._physicsRig.gravity.y=0,i}static delete(t){t!=null&&(t.release(),t=null)}parse(t,e){this._physicsRig=new $r;let i=new Gr(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,jr,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),Yr,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),Hr,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),Xr,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let r=0,a=0,n=0;for(let o=0;o<this._physicsRig.settings.getSize();++o){this._physicsRig.settings.at(o).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(o),this._physicsRig.settings.at(o).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(o),this._physicsRig.settings.at(o).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(o),this._physicsRig.settings.at(o).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(o),this._physicsRig.settings.at(o).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(o),this._physicsRig.settings.at(o).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(o),this._physicsRig.settings.at(o).inputCount=i.getInputCount(o),this._physicsRig.settings.at(o).baseInputIndex=r;for(let u=0;u<this._physicsRig.settings.at(o).inputCount;++u)this._physicsRig.inputs.at(r+u).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+u).weight=i.getInputWeight(o,u),this._physicsRig.inputs.at(r+u).reflect=i.getInputReflect(o,u),i.getInputType(o,u)==js?(this._physicsRig.inputs.at(r+u).type=St.CubismPhysicsSource_X,this._physicsRig.inputs.at(r+u).getNormalizedParameterValue=oo):i.getInputType(o,u)==Ys?(this._physicsRig.inputs.at(r+u).type=St.CubismPhysicsSource_Y,this._physicsRig.inputs.at(r+u).getNormalizedParameterValue=lo):i.getInputType(o,u)==Hs&&(this._physicsRig.inputs.at(r+u).type=St.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(r+u).getNormalizedParameterValue=uo),this._physicsRig.inputs.at(r+u).source.targetType=Ne.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(r+u).source.id=i.getInputSourceId(o,u);r+=this._physicsRig.settings.at(o).inputCount,this._physicsRig.settings.at(o).outputCount=i.getOutputCount(o),this._physicsRig.settings.at(o).baseOutputIndex=a;const l=new Gs;l.outputs.resize(this._physicsRig.settings.at(o).outputCount);const h=new Gs;h.outputs.resize(this._physicsRig.settings.at(o).outputCount);for(let u=0;u<this._physicsRig.settings.at(o).outputCount;++u)l.outputs.set(u,0),h.outputs.set(u,0),this._physicsRig.outputs.at(a+u).destinationParameterIndex=-1,this._physicsRig.outputs.at(a+u).vertexIndex=i.getOutputVertexIndex(o,u),this._physicsRig.outputs.at(a+u).angleScale=i.getOutputAngleScale(o,u),this._physicsRig.outputs.at(a+u).weight=i.getOutputWeight(o,u),this._physicsRig.outputs.at(a+u).destination.targetType=Ne.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(a+u).destination.id=i.getOutputDestinationId(o,u),i.getOutputType(o,u)==js?(this._physicsRig.outputs.at(a+u).type=St.CubismPhysicsSource_X,this._physicsRig.outputs.at(a+u).getValue=ho,this._physicsRig.outputs.at(a+u).getScale=fo):i.getOutputType(o,u)==Ys?(this._physicsRig.outputs.at(a+u).type=St.CubismPhysicsSource_Y,this._physicsRig.outputs.at(a+u).getValue=co,this._physicsRig.outputs.at(a+u).getScale=po):i.getOutputType(o,u)==Hs&&(this._physicsRig.outputs.at(a+u).type=St.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(a+u).getValue=go,this._physicsRig.outputs.at(a+u).getScale=yo),this._physicsRig.outputs.at(a+u).reflect=i.getOutputReflect(o,u);this._currentRigOutputs.pushBack(l),this._previousRigOutputs.pushBack(h),a+=this._physicsRig.settings.at(o).outputCount,this._physicsRig.settings.at(o).particleCount=i.getParticleCount(o),this._physicsRig.settings.at(o).baseParticleIndex=n;for(let u=0;u<this._physicsRig.settings.at(o).particleCount;++u)this._physicsRig.particles.at(n+u).mobility=i.getParticleMobility(o,u),this._physicsRig.particles.at(n+u).delay=i.getParticleDelay(o,u),this._physicsRig.particles.at(n+u).acceleration=i.getParticleAcceleration(o,u),this._physicsRig.particles.at(n+u).radius=i.getParticleRadius(o,u),this._physicsRig.particles.at(n+u).position=i.getParticlePosition(o,u);n+=this._physicsRig.settings.at(o).particleCount}this.initialize(),i.release(),i=void 0,i=null}stabilization(t){var p,_;let e,i,r,a;const n=new M;let o,l,h,u;const g=t.getModel().parameters.values,f=t.getModel().parameters.maximumValues,d=t.getModel().parameters.minimumValues,c=t.getModel().parameters.defaultValues;(((p=this._parameterCaches)==null?void 0:p.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((_=this._parameterInputCaches)==null?void 0:_.length)??0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let S=0;S<t.getParameterCount();++S)this._parameterCaches[S]=g[S],this._parameterInputCaches[S]=g[S];for(let S=0;S<this._physicsRig.subRigCount;++S){e={angle:0},n.x=0,n.y=0,o=this._physicsRig.settings.at(S),l=this._physicsRig.inputs.get(o.baseInputIndex),h=this._physicsRig.outputs.get(o.baseOutputIndex),u=this._physicsRig.particles.get(o.baseParticleIndex);for(let x=0;x<o.inputCount;++x)i=l[x].weight/pi,l[x].sourceParameterIndex==-1&&(l[x].sourceParameterIndex=t.getParameterIndex(l[x].source.id)),l[x].getNormalizedParameterValue(n,e,g[l[x].sourceParameterIndex],d[l[x].sourceParameterIndex],f[l[x].sourceParameterIndex],c[l[x].sourceParameterIndex],o.normalizationPosition,o.normalizationAngle,l[x].reflect,i),this._parameterCaches[l[x].sourceParameterIndex]=g[l[x].sourceParameterIndex];r=I.degreesToRadian(-e.angle),n.x=n.x*I.cos(r)-n.y*I.sin(r),n.y=n.x*I.sin(r)+n.y*I.cos(r),xo(u,o.particleCount,n,e.angle,this._options.wind,$s*o.normalizationPosition.maximum);for(let x=0;x<o.outputCount;++x){const C=h[x].vertexIndex;if(h[x].destinationParameterIndex==-1&&(h[x].destinationParameterIndex=t.getParameterIndex(h[x].destination.id)),C<1||C>=o.particleCount)continue;let w=new M;w=u[C].position.substract(u[C-1].position),a=h[x].getValue(w,u,C,h[x].reflect,this._options.gravity),this._currentRigOutputs.at(S).outputs.set(x,a),this._previousRigOutputs.at(S).outputs.set(x,a);const B=h[x].destinationParameterIndex,v=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(g.subarray(B))):g.slice(B);ni(v,d[B],f[B],a,h[x]);for(let T=B,X=0;T<this._parameterCaches.length;T++,X++)g[T]=this._parameterCaches[T]=v[X]}}}evaluate(t,e){var x,C;let i,r,a,n;const o=new M;let l,h,u,g;if(0>=e)return;const f=t.getModel().parameters.values,d=t.getModel().parameters.maximumValues,c=t.getModel().parameters.minimumValues,p=t.getModel().parameters.defaultValues;let _;if(this._currentRemainTime+=e,this._currentRemainTime>ao&&(this._currentRemainTime=0),(((x=this._parameterCaches)==null?void 0:x.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((C=this._parameterInputCaches)==null?void 0:C.length)??0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let w=0;w<t.getParameterCount();++w)this._parameterInputCaches[w]=f[w]}for(this._physicsRig.fps>0?_=1/this._physicsRig.fps:_=e;this._currentRemainTime>=_;){for(let B=0;B<this._physicsRig.subRigCount;++B){l=this._physicsRig.settings.at(B),u=this._physicsRig.outputs.get(l.baseOutputIndex);for(let v=0;v<l.outputCount;++v)this._previousRigOutputs.at(B).outputs.set(v,this._currentRigOutputs.at(B).outputs.at(v))}const w=_/this._currentRemainTime;for(let B=0;B<t.getParameterCount();++B)this._parameterCaches[B]=this._parameterInputCaches[B]*(1-w)+f[B]*w,this._parameterInputCaches[B]=this._parameterCaches[B];for(let B=0;B<this._physicsRig.subRigCount;++B){i={angle:0},o.x=0,o.y=0,l=this._physicsRig.settings.at(B),h=this._physicsRig.inputs.get(l.baseInputIndex),u=this._physicsRig.outputs.get(l.baseOutputIndex),g=this._physicsRig.particles.get(l.baseParticleIndex);for(let v=0;v<l.inputCount;++v)r=h[v].weight/pi,h[v].sourceParameterIndex==-1&&(h[v].sourceParameterIndex=t.getParameterIndex(h[v].source.id)),h[v].getNormalizedParameterValue(o,i,this._parameterCaches[h[v].sourceParameterIndex],c[h[v].sourceParameterIndex],d[h[v].sourceParameterIndex],p[h[v].sourceParameterIndex],l.normalizationPosition,l.normalizationAngle,h[v].reflect,r);a=I.degreesToRadian(-i.angle),o.x=o.x*I.cos(a)-o.y*I.sin(a),o.y=o.x*I.sin(a)+o.y*I.cos(a),So(g,l.particleCount,o,i.angle,this._options.wind,$s*l.normalizationPosition.maximum,_,ro);for(let v=0;v<l.outputCount;++v){const T=u[v].vertexIndex;if(u[v].destinationParameterIndex==-1&&(u[v].destinationParameterIndex=t.getParameterIndex(u[v].destination.id)),T<1||T>=l.particleCount)continue;const X=new M;X.x=g[T].position.x-g[T-1].position.x,X.y=g[T].position.y-g[T-1].position.y,n=u[v].getValue(X,g,T,u[v].reflect,this._options.gravity),this._currentRigOutputs.at(B).outputs.set(v,n);const Z=u[v].destinationParameterIndex,ht=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(Z))):this._parameterCaches.slice(Z);ni(ht,c[Z],d[Z],n,u[v]);for(let ct=Z,nt=0;ct<this._parameterCaches.length;ct++,nt++)this._parameterCaches[ct]=ht[nt]}}this._currentRemainTime-=_}const S=this._currentRemainTime/_;this.interpolate(t,S)}interpolate(t,e){let i,r;const a=t.getModel().parameters.values,n=t.getModel().parameters.maximumValues,o=t.getModel().parameters.minimumValues;for(let l=0;l<this._physicsRig.subRigCount;++l){r=this._physicsRig.settings.at(l),i=this._physicsRig.outputs.get(r.baseOutputIndex);for(let h=0;h<r.outputCount;++h){if(i[h].destinationParameterIndex==-1)continue;const u=i[h].destinationParameterIndex,g=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(a.subarray(u))):a.slice(u);ni(g,o[u],n[u],this._previousRigOutputs.at(l).outputs.at(h)*(1-e)+this._currentRigOutputs.at(l).outputs.at(h)*e,i[h]);for(let f=u,d=0;f<a.length;f++,d++)a[f]=g[d]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new qr,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new P,this._previousRigOutputs=new P,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,e,i;for(let r=0;r<this._physicsRig.subRigCount;++r){e=this._physicsRig.settings.at(r),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new M(0,0),t[0].lastPosition=new M(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new M(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new M(0,0),t[0].force=new M(0,0);for(let a=1;a<e.particleCount;++a)i=new M(0,0),i.y=t[a].radius,t[a].initialPosition=new M(t[a-1].initialPosition.x+i.x,t[a-1].initialPosition.y+i.y),t[a].position=new M(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastPosition=new M(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastGravity=new M(0,-1),t[a].lastGravity.y*=-1,t[a].velocity=new M(0,0),t[a].force=new M(0,0)}}}class qr{constructor(){this.gravity=new M(0,0),this.wind=new M(0,0)}}class Gs{constructor(){this.outputs=new P(0)}}function no(s){let t=0;return s>0?t=1:s<0&&(t=-1),t}function oo(s,t,e,i,r,a,n,o,l,h){s.x+=Ei(e,i,r,a,n.minimum,n.maximum,n.defalut,l)*h}function lo(s,t,e,i,r,a,n,o,l,h){s.y+=Ei(e,i,r,a,n.minimum,n.maximum,n.defalut,l)*h}function uo(s,t,e,i,r,a,n,o,l,h){t.angle+=Ei(e,i,r,a,o.minimum,o.maximum,o.defalut,l)*h}function ho(s,t,e,i,r){let a=s.x;return i&&(a*=-1),a}function co(s,t,e,i,r){let a=s.y;return i&&(a*=-1),a}function go(s,t,e,i,r){let a;return e>=2?r=t[e-1].position.substract(t[e-2].position):r=r.multiplyByScaler(-1),a=I.directionToRadian(r,s),i&&(a*=-1),a}function _o(s,t){const e=I.max(s,t),i=I.min(s,t);return I.abs(e-i)}function mo(s,t){return I.min(s,t)+_o(s,t)/2}function fo(s,t){return JSON.parse(JSON.stringify(s.x))}function po(s,t){return JSON.parse(JSON.stringify(s.y))}function yo(s,t){return JSON.parse(JSON.stringify(t))}function So(s,t,e,i,r,a,n,o){let l,h,u=new M(0,0),g=new M(0,0),f=new M(0,0),d=new M(0,0);s[0].position=new M(e.x,e.y);const c=I.degreesToRadian(i),p=I.radianToDirection(c);p.normalize();for(let _=1;_<t;++_)s[_].force=p.multiplyByScaler(s[_].acceleration).add(r),s[_].lastPosition=new M(s[_].position.x,s[_].position.y),l=s[_].delay*n*30,u=s[_].position.substract(s[_-1].position),h=I.directionToRadian(s[_].lastGravity,p)/o,u.x=I.cos(h)*u.x-u.y*I.sin(h),u.y=I.sin(h)*u.x+u.y*I.cos(h),s[_].position=s[_-1].position.add(u),g=s[_].velocity.multiplyByScaler(l),f=s[_].force.multiplyByScaler(l).multiplyByScaler(l),s[_].position=s[_].position.add(g).add(f),d=s[_].position.substract(s[_-1].position),d.normalize(),s[_].position=s[_-1].position.add(d.multiplyByScaler(s[_].radius)),I.abs(s[_].position.x)<a&&(s[_].position.x=0),l!=0&&(s[_].velocity=s[_].position.substract(s[_].lastPosition),s[_].velocity=s[_].velocity.divisionByScalar(l),s[_].velocity=s[_].velocity.multiplyByScaler(s[_].mobility)),s[_].force=new M(0,0),s[_].lastGravity=new M(p.x,p.y)}function xo(s,t,e,i,r,a){let n=new M(0,0);s[0].position=new M(e.x,e.y);const o=I.degreesToRadian(i),l=I.radianToDirection(o);l.normalize();for(let h=1;h<t;++h)s[h].force=l.multiplyByScaler(s[h].acceleration).add(r),s[h].lastPosition=new M(s[h].position.x,s[h].position.y),s[h].velocity=new M(0,0),n=s[h].force,n.normalize(),n=n.multiplyByScaler(s[h].radius),s[h].position=s[h-1].position.add(n),I.abs(s[h].position.x)<a&&(s[h].position.x=0),s[h].force=new M(0,0),s[h].lastGravity=new M(l.x,l.y)}function ni(s,t,e,i,r){let a;const n=r.getScale(r.translationScale,r.angleScale);a=i*n,a<t?(a<r.valueBelowMinimum&&(r.valueBelowMinimum=a),a=t):a>e&&(a>r.valueExceededMaximum&&(r.valueExceededMaximum=a),a=e);const o=r.weight/pi;o>=1||(a=s[0]*(1-o)+a*o),s[0]=a}function Ei(s,t,e,i,r,a,n,o){let l=0;const h=I.max(e,t);h<s&&(s=h);const u=I.min(e,t);u>s&&(s=u);const g=I.min(r,a),f=I.max(r,a),d=n,c=mo(u,h),p=s-c;switch(no(p)){case 1:{const _=f-d,S=h-c;S!=0&&(l=p*(_/S),l+=d);break}case-1:{const _=g-d,S=u-c;S!=0&&(l=p*(_/S),l+=d);break}case 0:{l=d;break}}return o?l:l*-1}var qs;(s=>{s.CubismPhysics=ge,s.Options=qr})(qs||(qs={}));const oi=4,Co=36,Po=32;class bo{constructor(t){this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new P,this._clippingContextListForDraw=new P,this._channelColors=new P,this._tmpBoundsOnModel=new Ae,this._tmpMatrix=new k,this._tmpMatrixForMask=new k,this._tmpMatrixForDraw=new k,this._clippingContexttConstructor=t;let e=new j;e.r=1,e.g=0,e.b=0,e.a=0,this._channelColors.pushBack(e),e=new j,e.r=0,e.g=1,e.b=0,e.a=0,this._channelColors.pushBack(e),e=new j,e.r=0,e.g=0,e.b=1,e.a=0,this._channelColors.pushBack(e),e=new j,e.r=0,e.g=0,e.b=0,e.a=1,this._channelColors.pushBack(e)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null;for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this._clearedFrameBufferFlags!=null&&this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=null}initialize(t,e){e%1!=0&&(xt("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),e=~~e),e<1&&xt("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=e<1?1:e,this._clearedFrameBufferFlags=new P(this._renderTextureCount);for(let i=0;i<t.getDrawableCount();i++){if(t.getDrawableMaskCounts()[i]<=0){this._clippingContextListForDraw.pushBack(null);continue}let r=this.findSameClip(t.getDrawableMasks()[i],t.getDrawableMaskCounts()[i]);r==null&&(r=new this._clippingContexttConstructor(this,t.getDrawableMasks()[i],t.getDrawableMaskCounts()[i]),this._clippingContextListForMask.pushBack(r)),r.addClippedDrawable(i),this._clippingContextListForDraw.pushBack(r)}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const r=this._clippingContextListForMask.at(i),a=r._clippingIdCount;if(a!=e)continue;let n=0;for(let o=0;o<a;o++){const l=r._clippingIdList[o];for(let h=0;h<a;h++)if(t[h]==l){n++;break}}if(n==a)return r}return null}setupMatrixForHighPrecision(t,e){let i=0;for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&i++}if(i>0){if(this.setupLayoutBounds(0),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount){this._clearedFrameBufferFlags.clear();for(let r=0;r<this._renderTextureCount;r++)this._clearedFrameBufferFlags.pushBack(!1)}else for(let r=0;r<this._renderTextureCount;r++)this._clearedFrameBufferFlags.set(r,!1);for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r),n=a._allClippedDrawRect,o=a._layoutBounds,l=.05;let h=0,u=0;const g=t.getPixelsPerUnit(),f=a.getClippingManager().getClippingMaskBufferSize(),d=o.width*f,c=o.height*f;this._tmpBoundsOnModel.setRect(n),this._tmpBoundsOnModel.width*g>d?(this._tmpBoundsOnModel.expand(n.width*l,0),h=o.width/this._tmpBoundsOnModel.width):h=g/d,this._tmpBoundsOnModel.height*g>c?(this._tmpBoundsOnModel.expand(0,n.height*l),u=o.height/this._tmpBoundsOnModel.height):u=g/c,this.createMatrixForMask(e,o,h,u),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray())}}}createMatrixForMask(t,e,i,r){this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(e.x,e.y),this._tmpMatrix.scaleRelative(i,r),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(e.x,e.y*(t?-1:1)),this._tmpMatrix.scaleRelative(i,r*(t?-1:1)),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray())}setupLayoutBounds(t){const e=this._renderTextureCount<=1?Co:Po*this._renderTextureCount;if(t<=0||t>e){t>e&&F(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let h=0;h<this._clippingContextListForMask.getSize();h++){const u=this._clippingContextListForMask.at(h);u._layoutChannelIndex=0,u._layoutBounds.x=0,u._layoutBounds.y=0,u._layoutBounds.width=1,u._layoutBounds.height=1,u._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let r=t/this._renderTextureCount;const a=t%this._renderTextureCount;r=Math.ceil(r);let n=r/oi;const o=r%oi;n=~~n;let l=0;for(let h=0;h<this._renderTextureCount;h++)for(let u=0;u<oi;u++){let g=n+(u<o?1:0);const f=o+(n<1?-1:0);if(u==f&&a>0&&(g-=h<a?0:1),g!=0)if(g==1){const d=this._clippingContextListForMask.at(l++);d._layoutChannelIndex=u,d._layoutBounds.x=0,d._layoutBounds.y=0,d._layoutBounds.width=1,d._layoutBounds.height=1,d._bufferIndex=h}else if(g==2)for(let d=0;d<g;d++){let c=d%2;c=~~c;const p=this._clippingContextListForMask.at(l++);p._layoutChannelIndex=u,p._layoutBounds.x=c*.5,p._layoutBounds.y=0,p._layoutBounds.width=.5,p._layoutBounds.height=1,p._bufferIndex=h}else if(g<=4)for(let d=0;d<g;d++){let c=d%2,p=d/2;c=~~c,p=~~p;const _=this._clippingContextListForMask.at(l++);_._layoutChannelIndex=u,_._layoutBounds.x=c*.5,_._layoutBounds.y=p*.5,_._layoutBounds.width=.5,_._layoutBounds.height=.5,_._bufferIndex=h}else if(g<=i)for(let d=0;d<g;d++){let c=d%3,p=d/3;c=~~c,p=~~p;const _=this._clippingContextListForMask.at(l++);_._layoutChannelIndex=u,_._layoutBounds.x=c/3,_._layoutBounds.y=p/3,_._layoutBounds.width=1/3,_._layoutBounds.height=1/3,_._bufferIndex=h}else{F(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let d=0;d<g;d++){const c=this._clippingContextListForMask.at(l++);c._layoutChannelIndex=0,c._layoutBounds.x=0,c._layoutBounds.y=0,c._layoutBounds.width=1,c._layoutBounds.height=1,c._bufferIndex=0}}}}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,r=Number.MAX_VALUE,a=Number.MIN_VALUE,n=Number.MIN_VALUE;const o=e._clippedDrawableIndexList.length;for(let l=0;l<o;l++){const h=e._clippedDrawableIndexList[l],u=t.getDrawableVertexCount(h),g=t.getDrawableVertices(h);let f=Number.MAX_VALUE,d=Number.MAX_VALUE,c=-Number.MAX_VALUE,p=-Number.MAX_VALUE;const _=u*Ct.vertexStep;for(let S=Ct.vertexOffset;S<_;S+=Ct.vertexStep){const x=g[S],C=g[S+1];x<f&&(f=x),x>c&&(c=x),C<d&&(d=C),C>p&&(p=C)}if(f!=Number.MAX_VALUE)if(f<i&&(i=f),d<r&&(r=d),c>a&&(a=c),p>n&&(n=p),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const S=a-i,x=n-r;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=r,e._allClippedDrawRect.width=S,e._allClippedDrawRect.height=x}}}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}getChannelFlagAsColor(t){return this._channelColors.at(t)}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}}let vt;const Mo=10;class Tt{static getInstance(){return vt==null&&(vt=new Tt),vt}static deleteInstance(){vt&&(vt.release(),vt=null)}constructor(){this._shaderSets=new P}release(){this.releaseShaderProgram()}setupShaderProgramForDraw(t,e,i){t.isPremultipliedAlpha()||F("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let r,a,n,o;const l=t.getClippingContextBufferForDraw()!=null,h=e.getDrawableInvertedMaskBit(i),u=l?h?2:1:0;let g;switch(e.getDrawableBlendMode(i)){case bt.CubismBlendMode_Normal:default:g=this._shaderSets.at(1+u),r=this.gl.ONE,a=this.gl.ONE_MINUS_SRC_ALPHA,n=this.gl.ONE,o=this.gl.ONE_MINUS_SRC_ALPHA;break;case bt.CubismBlendMode_Additive:g=this._shaderSets.at(4+u),r=this.gl.ONE,a=this.gl.ONE,n=this.gl.ZERO,o=this.gl.ONE;break;case bt.CubismBlendMode_Multiplicative:g=this._shaderSets.at(7+u),r=this.gl.DST_COLOR,a=this.gl.ONE_MINUS_SRC_ALPHA,n=this.gl.ZERO,o=this.gl.ONE;break}this.gl.useProgram(g.shaderProgram),t._bufferData.vertex==null&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const f=e.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,f,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributePositionLocation),this.gl.vertexAttribPointer(g.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const d=e.getDrawableVertexUvs(i);if(this.gl.bufferData(this.gl.ARRAY_BUFFER,d,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributeTexCoordLocation),this.gl.vertexAttribPointer(g.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),l){this.gl.activeTexture(this.gl.TEXTURE1);const B=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(t.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,B),this.gl.uniform1i(g.samplerTexture1Location,1),this.gl.uniformMatrix4fv(g.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const v=t.getClippingContextBufferForDraw()._layoutChannelIndex,T=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(v);this.gl.uniform4f(g.uniformChannelFlagLocation,T.r,T.g,T.b,T.a)}const c=e.getDrawableTextureIndex(i),p=t.getBindedTextures().getValue(c);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,p),this.gl.uniform1i(g.samplerTexture0Location,0);const _=t.getMvpMatrix();this.gl.uniformMatrix4fv(g.uniformMatrixLocation,!1,_.getArray());const S=t.getModelColorWithOpacity(e.getDrawableOpacity(i)),x=e.getMultiplyColor(i),C=e.getScreenColor(i);this.gl.uniform4f(g.uniformBaseColorLocation,S.r,S.g,S.b,S.a),this.gl.uniform4f(g.uniformMultiplyColorLocation,x.r,x.g,x.b,x.a),this.gl.uniform4f(g.uniformScreenColorLocation,C.r,C.g,C.b,C.a),t._bufferData.index==null&&(t._bufferData.index=this.gl.createBuffer());const w=e.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,w,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(r,a,n,o)}setupShaderProgramForMask(t,e,i){t.isPremultipliedAlpha()||F("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();const r=this._shaderSets.at(0);this.gl.useProgram(r.shaderProgram),t._bufferData.vertex==null&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const a=e.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributePositionLocation),this.gl.vertexAttribPointer(r.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const n=e.getDrawableTextureIndex(i),o=t.getBindedTextures().getValue(n);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,o),this.gl.uniform1i(r.samplerTexture0Location,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const l=e.getDrawableVertexUvs(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributeTexCoordLocation),this.gl.vertexAttribPointer(r.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),t.getClippingContextBufferForMask();const h=t.getClippingContextBufferForMask()._layoutChannelIndex,u=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(h);this.gl.uniform4f(r.uniformChannelFlagLocation,u.r,u.g,u.b,u.a),this.gl.uniformMatrix4fv(r.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const g=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(r.uniformBaseColorLocation,g.x*2-1,g.y*2-1,g.getRight()*2-1,g.getBottom()*2-1);const f=e.getMultiplyColor(i),d=e.getScreenColor(i);this.gl.uniform4f(r.uniformMultiplyColorLocation,f.r,f.g,f.b,f.a),this.gl.uniform4f(r.uniformScreenColorLocation,d.r,d.g,d.b,d.a);const c=this.gl.ZERO,p=this.gl.ONE_MINUS_SRC_COLOR,_=this.gl.ZERO,S=this.gl.ONE_MINUS_SRC_ALPHA;t._bufferData.index==null&&(t._bufferData.index=this.gl.createBuffer());const x=e.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,x,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(c,p,_,S)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<Mo;t++)this._shaderSets.pushBack(new Wr);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(wo,Bo),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(Io,vo),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(Ws,Ro),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(Ws,Eo),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!r)return F("Vertex shader compile error!"),0;let a=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return a?(this.gl.attachShader(i,r),this.gl.attachShader(i,a),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(a),i):(F("Failed to link program: {0}",i),this.gl.deleteShader(r),r=0,this.gl.deleteShader(a),a=0,i&&(this.gl.deleteProgram(i),i=0),0)):(F("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,r=this.gl.createShader(t);if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!r){const n=this.gl.getShaderInfoLog(r);F("Shader compile log: {0} ",n)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)}setGl(t){this.gl=t}}class Wr{}var Jr=(s=>(s[s.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",s[s.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",s[s.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",s[s.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",s[s.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",s[s.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",s[s.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",s[s.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",s[s.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",s[s.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",s))(Jr||{});const wo="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Bo="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",Io="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Ws="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",vo="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",Ro="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",Eo="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";var Js;(s=>{s.CubismShaderSet=Wr,s.CubismShader_WebGL=Tt,s.ShaderNames=Jr})(Js||(Js={}));let dt,Ue;class yi extends bo{getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=new P,this._maskColorBuffers!=null&&this._maskColorBuffers.clear(),this._maskColorBuffers=new P;const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(e)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(e)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(e),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Ue),this._maskTexture=new Kr(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}constructor(){super(Zr)}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),e.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=new P(this._renderTextureCount));for(let r=0;r<this._clearedFrameBufferFlags.getSize();r++)this._clearedFrameBufferFlags.set(r,!1);for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r),n=a._allClippedDrawRect,o=a._layoutBounds,l=.05;let h=0,u=0;const g=this.getMaskRenderTexture().at(a._bufferIndex);this._currentMaskRenderTexture!=g&&(this._currentMaskRenderTexture=g,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._tmpBoundsOnModel.setRect(n),this._tmpBoundsOnModel.expand(n.width*l,n.height*l),h=o.width/this._tmpBoundsOnModel.width,u=o.height/this._tmpBoundsOnModel.height,this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(o.x,o.y),this._tmpMatrix.scaleRelative(h,u),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(o.x,o.y),this._tmpMatrix.scaleRelative(h,u),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const f=a._clippingIdCount;for(let d=0;d<f;d++){const c=a._clippingIdList[d];t.getDrawableDynamicFlagVertexPositionsDidChange(c)&&(e.setIsCulling(t.getDrawableCulling(c)!=!1),this._clearedFrameBufferFlags.at(a._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferFlags.set(a._bufferIndex,!0)),e.setClippingContextBufferForMask(a),e.drawMeshWebGL(t,c))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Ue),e.setClippingContextBufferForMask(null),this.gl.viewport(dt[0],dt[1],dt[2],dt[3])}}getColorBuffer(){return this._maskColorBuffers}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}}class Kr{constructor(t,e){this.frameNo=t,this.textures=e}}class Zr extends Ea{constructor(t,e,i){super(e,i),this._owner=t}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class To{setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){if(this.gl==null){F(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastElementArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){F(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(t){this.gl=t}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class Ti extends Xe{initialize(t,e=1){t.isUsingMasking()&&(this._clippingManager=new yi,this._clippingManager.initialize(t,e)),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const e=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new yi,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),e)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new To,this.firstDraw=!0,this._textures=new q,this._sortedDrawableIndexList=new P,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),this.gl!=null&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(this.gl==null){F(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this.isUsingHighPrecisionMask()?this._clippingManager.setupMatrixForHighPrecision(this.getModel(),!1):this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const r=e[i];this._sortedDrawableIndexList.set(r,i)}for(let i=0;i<t;++i){const r=this._sortedDrawableIndexList.at(i);if(!this.getModel().getDrawableDynamicFlagIsVisible(r))continue;const a=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(r):null;if(a!=null&&this.isUsingHighPrecisionMask()){a._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.getClippingManager().getMaskRenderTexture().at(a._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const n=a._clippingIdCount;for(let o=0;o<n;o++){const l=a._clippingIdList[o];this._model.getDrawableDynamicFlagVertexPositionsDidChange(l)&&(this.setIsCulling(this._model.getDrawableCulling(l)!=!1),this.setClippingContextBufferForMask(a),this.drawMeshWebGL(this._model,l))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Ue),this.setClippingContextBufferForMask(null),this.gl.viewport(dt[0],dt[1],dt[2],dt[3]),this.preDraw()}this.setClippingContextBufferForDraw(a),this.setIsCulling(this.getModel().getDrawableCulling(r)),this.drawMeshWebGL(this._model,r)}}drawMeshWebGL(t,e){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW),this.isGeneratingMask()?Tt.getInstance().setupShaderProgramForMask(this,t,e):Tt.getInstance().setupShaderProgramForDraw(this,t,e);{const i=t.getDrawableVertexIndexCount(e);this.gl.drawElements(this.gl.TRIANGLES,i,this.gl.UNSIGNED_SHORT,0)}this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){Tt.deleteInstance()}setRenderState(t,e){Ue=t,dt=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let t=0;t<this._textures.getSize();++t)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(t)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}isGeneratingMask(){return this.getClippingContextBufferForMask()!=null}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),Tt.getInstance().setGl(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}Xe.staticRelease=()=>{Ti.doStaticRelease()};var Ks;(s=>{s.CubismClippingContext=Zr,s.CubismClippingManager_WebGL=yi,s.CubismRenderTextureResource=Kr,s.CubismRenderer_WebGL=Ti})(Ks||(Ks={}));class Zs{constructor(t=!1,e=new j){this.isOverwritten=t,this.color=e}}class Qs{constructor(t=!1,e=new j){this.isOverwritten=t,this.color=e}}class Vo{constructor(t=!1,e=!1){this.isOverwritten=t,this.isCulling=e}}class Qr{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors.at(t).color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors.at(t).color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.r,e.g,e.b,e.a)}setMultiplyColorByRGBA(t,e,i,r,a=1){this._userMultiplyColors.at(t).color.r=e,this._userMultiplyColors.at(t).color.g=i,this._userMultiplyColors.at(t).color.b=r,this._userMultiplyColors.at(t).color.a=a}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.r,e.g,e.b,e.a)}setScreenColorByRGBA(t,e,i,r,a=1){this._userScreenColors.at(t).color.r=e,this._userScreenColors.at(t).color.g=i,this._userScreenColors.at(t).color.b=r,this._userScreenColors.at(t).color.a=a}getPartMultiplyColor(t){return this._userPartMultiplyColors.at(t).color}getPartScreenColor(t){return this._userPartScreenColors.at(t).color}setPartColor(t,e,i,r,a,n,o){if(n.at(t).color.r=e,n.at(t).color.g=i,n.at(t).color.b=r,n.at(t).color.a=a,n.at(t).isOverwritten)for(let l=0;l<this._partChildDrawables.at(t).getSize();++l){const h=this._partChildDrawables.at(t).at(l);o.at(h).color.r=e,o.at(h).color.g=i,o.at(h).color.b=r,o.at(h).color.a=a}}setPartMultiplyColorByTextureColor(t,e){this.setPartMultiplyColorByRGBA(t,e.r,e.g,e.b,e.a)}setPartMultiplyColorByRGBA(t,e,i,r,a){this.setPartColor(t,e,i,r,a,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,e){this.setPartScreenColorByRGBA(t,e.r,e.g,e.b,e.a)}setPartScreenColorByRGBA(t,e,i,r,a){this.setPartColor(t,e,i,r,a,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userScreenColors.at(t).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors.at(t).isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors.at(t).isOverwritten=e}getOverwriteColorForPartMultiplyColors(t){return this._userPartMultiplyColors.at(t).isOverwritten}getOverwriteColorForPartScreenColors(t){return this._userPartScreenColors.at(t).isOverwritten}setOverwriteColorForPartColors(t,e,i,r){i.at(t).isOverwritten=e;for(let a=0;a<this._partChildDrawables.at(t).getSize();++a){const n=this._partChildDrawables.at(t).at(a);r.at(n).isOverwritten=e,e&&(r.at(n).color.r=i.at(t).color.r,r.at(n).color.g=i.at(t).color.g,r.at(n).color.b=i.at(t).color.b,r.at(n).color.a=i.at(t).color.a)}}setOverwriteColorForPartMultiplyColors(t,e){this._userPartMultiplyColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,e){this._userPartScreenColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(t))return this._userCullings.at(t).isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings.at(t).isCulling=e}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(t){this._isOverwrittenCullings=t}getOverwriteFlagForDrawableCullings(t){return this._userCullings.at(t).isOverwritten}setOverwriteFlagForDrawableCullings(t,e){this._userCullings.at(t).isOverwritten=e}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartId(t){const e=this._model.parts.ids[t];return E.getIdManager().getId(e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(this._notExistPartOpacities.isExist(t)){this._notExistPartOpacities.setValue(t,e);return}st(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(st(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterId(t){return E.getIdManager().getId(this._model.parameters.ids[t])}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(st(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(this._notExistParameterValues.isExist(t)){this._notExistParameterValues.setValue(t,i==1?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i);return}st(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.setParameterValueByIndex(r,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.addParameterValueByIndex(r,e,i)}multiplyParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.multiplyParameterValueByIndex(r,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return E.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=t*4,r=new j;return r.r=e[i],r.g=e[i+1],r.b=e[i+2],r.a=e[i+3],r}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=t*4,r=new j;return r.r=e[i],r.g=e[i+1],r.b=e[i+2],r.a=e[i+3],r}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?bt.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?bt.CubismBlendMode_Multiplicative:bt.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters.at(i)}initialize(){st(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,i=this._model.parameters.count;this._parameterIds.prepareCapacity(i);for(let r=0;r<i;++r)this._parameterIds.pushBack(E.getIdManager().getId(e[r]))}const t=this._model.parts.count;{const e=this._model.parts.ids;this._partIds.prepareCapacity(t);for(let i=0;i<t;++i)this._partIds.pushBack(E.getIdManager().getId(e[i]));this._userPartMultiplyColors.prepareCapacity(t),this._userPartScreenColors.prepareCapacity(t),this._partChildDrawables.prepareCapacity(t)}{const e=this._model.drawables.ids,i=this._model.drawables.count;this._userMultiplyColors.prepareCapacity(i),this._userScreenColors.prepareCapacity(i),this._userCullings.prepareCapacity(i);const r=new Vo(!1,!1);for(let a=0;a<t;++a){const n=new j(1,1,1,1),o=new j(0,0,0,1),l=new Qs(!1,n),h=new Qs(!1,o);this._userPartMultiplyColors.pushBack(l),this._userPartScreenColors.pushBack(h),this._partChildDrawables.pushBack(new P),this._partChildDrawables.at(a).prepareCapacity(i)}for(let a=0;a<i;++a){const n=new j(1,1,1,1),o=new j(0,0,0,1),l=new Zs(!1,n),h=new Zs(!1,o);this._drawableIds.pushBack(E.getIdManager().getId(e[a])),this._userMultiplyColors.pushBack(l),this._userScreenColors.pushBack(h),this._userCullings.pushBack(r);const u=this.getDrawableParentPartIndex(a);u>=0&&this._partChildDrawables.at(u).pushBack(a)}}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new P,this._parameterIds=new P,this._drawableIds=new P,this._partIds=new P,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=new P,this._userScreenColors=new P,this._userCullings=new P,this._userPartMultiplyColors=new P,this._userPartScreenColors=new P,this._partChildDrawables=new P,this._notExistPartId=new q,this._notExistParameterId=new q,this._notExistParameterValues=new q,this._notExistPartOpacities=new q}release(){this._model.release(),this._model=null}}var tr;(s=>{s.CubismModel=Qr})(tr||(tr={}));class me{static create(t,e){let i=null;if(e&&!this.hasMocConsistency(t))return F("Inconsistent MOC3."),i;const r=Live2DCubismCore.Moc.fromArrayBuffer(t);return r&&(i=new me(r),i._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(r,t)),i}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new Qr(e),t.initialize(),++this._modelCount),t}deleteModel(t){t!=null&&(t.release(),t=null,--this._modelCount)}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){st(this._modelCount==0),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return Live2DCubismCore.Moc.prototype.hasMocConsistency(t)===1}}var er;(s=>{s.CubismMoc=me})(er||(er={}));const ir="Meta",Fo="UserDataCount",Ao="TotalUserDataSize",li="UserData",Do="Target",Lo="Id",Oo="Value";class ta{constructor(t,e){this._json=N.create(t,e)}release(){N.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(ir).getValueByString(Fo).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(ir).getValueByString(Ao).toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(li).getValueByIndex(t).getValueByString(Do).getRawString()}getUserDataId(t){return E.getIdManager().getId(this._json.getRoot().getValueByString(li).getValueByIndex(t).getValueByString(Lo).getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(li).getValueByIndex(t).getValueByString(Oo).getRawString()}}var sr;(s=>{s.CubismModelUserDataJson=ta})(sr||(sr={}));const ko="ArtMesh";class ea{}class de{static create(t,e){const i=new de;return i.parseUserData(t,e),i}static delete(t){t!=null&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let i=new ta(t,e);if(!i){i.release(),i=void 0;return}const r=E.getIdManager().getId(ko),a=i.getUserDataCount();for(let n=0;n<a;n++){const o=new ea;o.targetId=i.getUserDataId(n),o.targetType=E.getIdManager().getId(i.getUserDataTargetType(n)),o.value=new K(i.getUserDataValue(n)),this._userDataNodes.pushBack(o),o.targetType==r&&this._artMeshUserDataNode.pushBack(o)}i.release(),i=void 0}constructor(){this._userDataNodes=new P,this._artMeshUserDataNode=new P}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var rr;(s=>{s.CubismModelUserData=de,s.CubismModelUserDataNode=ea})(rr||(rr={}));class Ye{isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t,e=!1){if(this._moc=me.create(t,e),this._moc==null){F("Failed to CubismMoc.create().");return}if(this._model=this._moc.createModel(),this._model==null){F("Failed to CreateModel().");return}this._model.saveParameters(),this._modelMatrix=new Er(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadMotion(t,e,i,r){return t==null||e==0?(F("Failed to loadMotion()."),null):je.create(t,e,r)}loadExpression(t,e,i){return t==null||e==0?(F("Failed to loadExpression()."),null):Pt.create(t,e)}loadPose(t,e){if(t==null||e==0){F("Failed to loadPose().");return}this._pose=he.create(t,e)}loadUserData(t,e){if(t==null||e==0){F("Failed to loadUserData().");return}this._modelUserData=de.create(t,e)}loadPhysics(t,e){if(t==null||e==0){F("Failed to loadPhysics().");return}this._physics=ge.create(t,e)}isHit(t,e,i){const r=this._model.getDrawableIndex(t);if(r<0)return!1;const a=this._model.getDrawableVertexCount(r),n=this._model.getDrawableVertices(r);let o=n[0],l=n[0],h=n[1],u=n[1];for(let d=1;d<a;++d){const c=n[Ct.vertexOffset+d*Ct.vertexStep],p=n[Ct.vertexOffset+d*Ct.vertexStep+1];c<o&&(o=c),c>l&&(l=c),p<h&&(h=p),p>u&&(u=p)}const g=this._modelMatrix.invertTransformX(e),f=this._modelMatrix.invertTransformY(i);return o<=g&&g<=l&&h<=f&&f<=u}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(t=1){this._renderer&&this.deleteRenderer(),this._renderer=new Ti,this._renderer.initialize(this._model,t)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){J("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){const r=i;r!=null&&r.motionEventFired(e)}constructor(){this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!0,this._renderer=null,this._motionManager=new zr,this._motionManager.setEventCallback(Ye.cubismDefaultMotionEventCallback,this),this._expressionManager=new Ar,this._dragManager=new Tr}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,he.delete(this._pose),ue.delete(this._eyeBlink),_e.delete(this._breath),this._dragManager=null,ge.delete(this._physics),de.delete(this._modelUserData),this.deleteRenderer()}}var ar;(s=>{s.CubismUserModel=Ye})(ar||(ar={}));const Yt=class Yt{static loadFileAsBytes(t,e){fetch(t).then(i=>i.arrayBuffer()).then(i=>e(i,i.byteLength))}static getDeltaTime(){return this.s_deltaTime}static updateTime(){this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,this.s_lastFrame=this.s_currentFrame}static printMessage(t){console.log(t)}};Yt.lastUpdate=Date.now(),Yt.s_currentFrame=0,Yt.s_lastFrame=0,Yt.s_deltaTime=0;let V=Yt,Ut=null;class Vi{constructor(){this._loadFiletoBytes=(t,e)=>{this._byteReader._fileByte=t,this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=e},this._pcmData=null,this._userTimeSeconds=0,this._lastRms=0,this._sampleOffset=0,this._wavFileInfo=new No,this._byteReader=new Uo}static getInstance(){return Ut==null&&(Ut=new Vi),Ut}static releaseInstance(){Ut!=null&&(Ut=void 0),Ut=null}update(t){let e,i;if(this._pcmData==null||this._sampleOffset>=this._wavFileInfo._samplesPerChannel)return this._lastRms=0,!1;this._userTimeSeconds+=t,e=Math.floor(this._userTimeSeconds*this._wavFileInfo._samplingRate),e>this._wavFileInfo._samplesPerChannel&&(e=this._wavFileInfo._samplesPerChannel),i=0;for(let r=0;r<this._wavFileInfo._numberOfChannels;r++)for(let a=this._sampleOffset;a<e;a++){const n=this._pcmData[r][a];i+=n*n}return i=Math.sqrt(i/(this._wavFileInfo._numberOfChannels*(e-this._sampleOffset))),this._lastRms=i,this._sampleOffset=e,!0}start(t){this._sampleOffset=0,this._userTimeSeconds=0,this._lastRms=0,this.loadWavFile(t)}getRms(){return this._lastRms}loadWavFile(t){return new Promise(e=>{let i=!1;this._pcmData!=null&&this.releasePcmData();const r=async()=>fetch(t).then(a=>a.arrayBuffer());(async()=>{if(this._byteReader._fileByte=await r(),this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=this._byteReader._fileByte.byteLength,this._byteReader._readOffset=0,this._byteReader._fileByte==null||this._byteReader._fileSize<4){e(!1);return}this._wavFileInfo._fileName=t;try{if(!this._byteReader.getCheckSignature("RIFF"))throw i=!1,new Error('Cannot find Signeture "RIFF".');if(this._byteReader.get32LittleEndian(),!this._byteReader.getCheckSignature("WAVE"))throw i=!1,new Error('Cannot find Signeture "WAVE".');if(!this._byteReader.getCheckSignature("fmt "))throw i=!1,new Error('Cannot find Signeture "fmt".');const a=this._byteReader.get32LittleEndian();if(this._byteReader.get16LittleEndian()!=1)throw i=!1,new Error("File is not linear PCM.");for(this._wavFileInfo._numberOfChannels=this._byteReader.get16LittleEndian(),this._wavFileInfo._samplingRate=this._byteReader.get32LittleEndian(),this._byteReader.get32LittleEndian(),this._byteReader.get16LittleEndian(),this._wavFileInfo._bitsPerSample=this._byteReader.get16LittleEndian(),a>16&&(this._byteReader._readOffset+=a-16);!this._byteReader.getCheckSignature("data")&&this._byteReader._readOffset<this._byteReader._fileSize;)this._byteReader._readOffset+=this._byteReader.get32LittleEndian()+4;if(this._byteReader._readOffset>=this._byteReader._fileSize)throw i=!1,new Error('Cannot find "data" Chunk.');{const n=this._byteReader.get32LittleEndian();this._wavFileInfo._samplesPerChannel=n*8/(this._wavFileInfo._bitsPerSample*this._wavFileInfo._numberOfChannels)}this._pcmData=new Array(this._wavFileInfo._numberOfChannels);for(let n=0;n<this._wavFileInfo._numberOfChannels;n++)this._pcmData[n]=new Float32Array(this._wavFileInfo._samplesPerChannel);for(let n=0;n<this._wavFileInfo._samplesPerChannel;n++)for(let o=0;o<this._wavFileInfo._numberOfChannels;o++)this._pcmData[o][n]=this.getPcmSample();i=!0,e(i)}catch(a){console.log(a)}})().then(()=>{e(i)})})}getPcmSample(){let t;switch(this._wavFileInfo._bitsPerSample){case 8:t=this._byteReader.get8()-128,t<<=24;break;case 16:t=this._byteReader.get16LittleEndian()<<16;break;case 24:t=this._byteReader.get24LittleEndian()<<8;break;default:t=0;break}return t/2147483647}getPcmDataChannel(t){return!this._pcmData||!(t<this._pcmData.length)?null:Float32Array.from(this._pcmData[t])}getWavSamplingRate(){return!this._wavFileInfo||this._wavFileInfo._samplingRate<1?null:this._wavFileInfo._samplingRate}releasePcmData(){for(let t=0;t<this._wavFileInfo._numberOfChannels;t++)delete this._pcmData[t];delete this._pcmData,this._pcmData=null}}class No{constructor(){this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}}class Uo{constructor(){this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}get8(){const t=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,t}get16LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,t}get24LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,t}get32LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,t}getCheckSignature(t){const e=new Uint8Array(4),i=new TextEncoder().encode(t);if(t.length!=4)return!1;for(let r=0;r<4;r++)e[r]=this.get8();return e[0]==i[0]&&e[1]==i[1]&&e[2]==i[2]&&e[3]==i[3]}}class zo extends Ye{loadAssets(t,e){this._modelHomeDir=t,fetch(`${this._modelHomeDir}${e}`).then(i=>i.arrayBuffer()).then(i=>{const r=new vr(i,i.byteLength);this._state=1,this.setupModel(r)}).catch(i=>{F(`Failed to load file ${this._modelHomeDir}${e}`)})}setupModel(t){if(this._updating=!0,this._initialized=!1,this._modelSetting=t,this._modelSetting.getModelFileName()!=""){const f=this._modelSetting.getModelFileName();fetch(`${this._modelHomeDir}${f}`).then(d=>{if(d.ok)return d.arrayBuffer();if(d.status>=400)return F(`Failed to load file ${this._modelHomeDir}${f}`),new ArrayBuffer(0)}).then(d=>{this.loadModel(d,this._mocConsistency),this._state=3,console.log("Load complete"),e()}),this._state=2}else V.printMessage("Model data does not exist.");const e=()=>{if(this._modelSetting.getExpressionCount()>0){const f=this._modelSetting.getExpressionCount();for(let d=0;d<f;d++){const c=this._modelSetting.getExpressionName(d),p=this._modelSetting.getExpressionFileName(d);fetch(`${this._modelHomeDir}${p}`).then(_=>{if(_.ok)return _.arrayBuffer();if(_.status>=400)return F(`Failed to load file ${this._modelHomeDir}${p}`),new ArrayBuffer(0)}).then(_=>{const S=this.loadExpression(_,_.byteLength,c);this._expressions.getValue(c)!=null&&(Wt.delete(this._expressions.getValue(c)),this._expressions.setValue(c,null)),this._expressions.setValue(c,S),this._expressionCount++,this._expressionCount>=f&&(this._state=5,i())})}this._state=4}else this._state=5,i()},i=()=>{if(this._modelSetting.getPhysicsFileName()!=""){const f=this._modelSetting.getPhysicsFileName();fetch(`${this._modelHomeDir}${f}`).then(d=>{if(d.ok)return d.arrayBuffer();if(d.status>=400)return F(`Failed to load file ${this._modelHomeDir}${f}`),new ArrayBuffer(0)}).then(d=>{this.loadPhysics(d,d.byteLength),this._state=7,r()}),this._state=6}else this._state=7,r()},r=()=>{if(this._modelSetting.getPoseFileName()!=""){const f=this._modelSetting.getPoseFileName();fetch(`${this._modelHomeDir}${f}`).then(d=>{if(d.ok)return d.arrayBuffer();if(d.status>=400)return F(`Failed to load file ${this._modelHomeDir}${f}`),new ArrayBuffer(0)}).then(d=>{this.loadPose(d,d.byteLength),this._state=9,a()}),this._state=8}else this._state=9,a()},a=()=>{this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=ue.create(this._modelSetting),this._state=10),n()},n=()=>{this._breath=_e.create();const f=new P;f.pushBack(new Xt(this._idParamAngleX,0,15,6.5345,.5)),f.pushBack(new Xt(this._idParamAngleY,0,8,3.5345,.5)),f.pushBack(new Xt(this._idParamAngleZ,0,10,5.5345,.5)),f.pushBack(new Xt(this._idParamBodyAngleX,0,4,15.5345,.5)),f.pushBack(new Xt(E.getIdManager().getId(b.ParamBreath),.5,.5,3.2345,1)),this._breath.setParameters(f),this._state=11,o()},o=()=>{if(this._modelSetting.getUserDataFile()!=""){const f=this._modelSetting.getUserDataFile();fetch(`${this._modelHomeDir}${f}`).then(d=>{if(d.ok)return d.arrayBuffer();if(d.status>=400)return F(`Failed to load file ${this._modelHomeDir}${f}`),new ArrayBuffer(0)}).then(d=>{this.loadUserData(d,d.byteLength),this._state=13,l()}),this._state=12}else this._state=13,l()},l=()=>{const f=this._modelSetting.getEyeBlinkParameterCount();for(let d=0;d<f;++d)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(d));this._state=14,h()},h=()=>{const f=this._modelSetting.getLipSyncParameterCount();for(let d=0;d<f;++d)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(d));this._state=15,u()},u=()=>{const f=new q;if(this._modelSetting==null||this._modelMatrix==null){F("Failed to setupLayout().");return}this._modelSetting.getLayoutMap(f),this._modelMatrix.setupFromLayout(f),this._state=16,g()},g=()=>{this._state=17,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;const f=[],d=this._modelSetting.getMotionGroupCount();for(let c=0;c<d;c++)f[c]=this._modelSetting.getMotionGroupName(c),this._allMotionCount+=this._modelSetting.getMotionCount(f[c]);for(let c=0;c<d;c++)this.preLoadMotionGroup(f[c]);d==0&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(y))};J("CubismMotionManager::loadModel()")}setupTextures(){if(this._state==20){const e=this._modelSetting.getTextureCount();for(let i=0;i<e;i++){if(this._modelSetting.getTextureFileName(i)==""){console.log("getTextureFileName null");continue}let r=this._modelSetting.getTextureFileName(i);r=this._modelHomeDir+r;const a=n=>{this.getRenderer().bindTexture(i,n.id),this._textureCount++,this._textureCount>=e&&(this._state=22)};A.getInstance().getTextureManager().createTextureFromPngFile(r,!0,a),this.getRenderer().setIsPremultipliedAlpha(!0)}this._state=21}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(this._state!=22)return;const t=V.getDeltaTime();this._userTimeSeconds+=t,this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let e=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion(Ga,Wa):e=this._motionManager.updateMotion(this._model,t),this._model.saveParameters(),e||this._eyeBlink!=null&&this._eyeBlink.updateParameters(this._model,t),this._expressionManager!=null&&this._expressionManager.updateMotion(this._model,t),this._model.addParameterValueById(this._idParamAngleX,this._dragX*30),this._model.addParameterValueById(this._idParamAngleY,this._dragY*30),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,this._dragX*10),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),this._breath!=null&&this._breath.updateParameters(this._model,t),this._physics!=null&&this._physics.evaluate(this._model,t),this._lipsync){let i=0;this._wavFileHandler.update(t),i=this._wavFileHandler.getRms();for(let r=0;r<this._lipSyncIds.getSize();++r)this._model.addParameterValueById(this._lipSyncIds.at(r),i,.8)}this._pose!=null&&this._pose.updateParameters(this._model,t),this._model.update()}startMotion(t,e,i,r){if(i==Ke)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&V.printMessage("[APP]can't start motion."),ke;const a=this._modelSetting.getMotionFileName(t,e),n=`${t}_${e}`;let o=this._motions.getValue(n),l=!1;o==null?fetch(`${this._modelHomeDir}${a}`).then(u=>{if(u.ok)return u.arrayBuffer();if(u.status>=400)return F(`Failed to load file ${this._modelHomeDir}${a}`),new ArrayBuffer(0)}).then(u=>{if(o=this.loadMotion(u,u.byteLength,null,r),o==null)return;let g=this._modelSetting.getMotionFadeInTimeValue(t,e);g>=0&&o.setFadeInTime(g),g=this._modelSetting.getMotionFadeOutTimeValue(t,e),g>=0&&o.setFadeOutTime(g),o.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),l=!0}):o.setFinishedMotionHandler(r);const h=this._modelSetting.getMotionSoundFileName(t,e);if(h.localeCompare("")!=0){let u=h;u=this._modelHomeDir+u,this._wavFileHandler.start(u)}return this._debugMode&&V.printMessage(`[APP]start motion: [${t}_${e}`),this._motionManager.startMotionPriority(o,l,i)}startRandomMotion(t,e,i){if(this._modelSetting.getMotionCount(t)==0)return ke;const r=Math.floor(Math.random()*this._modelSetting.getMotionCount(t));return this.startMotion(t,r,e,i)}setExpression(t){const e=this._expressions.getValue(t);if(this._debugMode&&V.printMessage(`[APP]expression: [${t}]`),e!=null)return this._expressionManager.startMotionPriority(e,!0,Ke);this._debugMode&&V.printMessage(`[APP]expression[${t}] is null`)}async setExpressions(t){for(const e of t){const i=this._expressions.getValue(e);if(this._debugMode&&V.printMessage(`[APP]expression: [${e}]`),i!=null){const r=this._expressionManager.startMotionPriority(i,!0,Ke);await new Promise(a=>{const n=()=>{this._motionManager.isFinishedByHandle(r)?a():requestAnimationFrame(n)};n()})}else this._debugMode&&V.printMessage(`[APP]expression[${e}] is null`)}}setRandomExpression(){if(this._expressions.getSize()==0)return;const t=Math.floor(Math.random()*this._expressions.getSize());for(let e=0;e<this._expressions.getSize();e++)if(e==t){const i=this._expressions._keyValues[e].first;this.setExpression(i);return}}motionEventFired(t){J("{0} is fired on LAppModel!!",t.s)}hitTest(t,e,i){if(this._opacity<1)return!1;const r=this._modelSetting.getHitAreasCount();for(let a=0;a<r;a++)if(this._modelSetting.getHitAreaName(a)==t){const n=this._modelSetting.getHitAreaId(a);return this.isHit(n,e,i)}return!1}preLoadMotionGroup(t){for(let e=0;e<this._modelSetting.getMotionCount(t);e++){const i=this._modelSetting.getMotionFileName(t,e),r=`${t}_${e}`;this._debugMode&&V.printMessage(`[APP]load motion: ${i} => [${r}]`),fetch(`${this._modelHomeDir}${i}`).then(a=>{if(a.ok)return a.arrayBuffer();if(a.status>=400)return F(`Failed to load file ${this._modelHomeDir}${i}`),new ArrayBuffer(0)}).then(a=>{const n=this.loadMotion(a,a.byteLength,r);if(n!=null){let o=this._modelSetting.getMotionFadeInTimeValue(t,e);o>=0&&n.setFadeInTime(o),o=this._modelSetting.getMotionFadeOutTimeValue(t,e),o>=0&&n.setFadeOutTime(o),n.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),this._motions.getValue(r)!=null&&Wt.delete(this._motions.getValue(r)),this._motions.setValue(r,n),this._motionCount++,this._motionCount>=this._allMotionCount&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(y))}else this._allMotionCount--})}}releaseMotions(){this._motions.clear()}stopExpression(){const e=JSON.stringify({Type:"Live2D Expression",FadeInTime:1,FadeOutTime:1,Parameters:[]}),a=new TextEncoder().encode(e).buffer,o=this.loadExpression(a,a.byteLength,"stop");this._expressionManager.endMotion(o,!1)}releaseExpressions(){this._expressions.clear()}doDraw(){if(this._model==null)return;const t=[0,0,L.width,L.height];this.getRenderer().setRenderState(bi,t),this.getRenderer().drawModel()}draw(t){this._model!=null&&this._state==22&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())}async hasMocConsistencyFromFile(){if(st(this._modelSetting.getModelFileName().localeCompare("")),this._modelSetting.getModelFileName()!=""){const t=this._modelSetting.getModelFileName(),i=await(await fetch(`${this._modelHomeDir}${t}`)).arrayBuffer();return this._consistency=me.hasMocConsistency(i),this._consistency?J("Consistent MOC3."):J("Inconsistent MOC3."),this._consistency}else V.printMessage("Model data does not exist.")}constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new P,this._lipSyncIds=new P,this._motions=new q,this._expressions=new q,this._hitArea=new P,this._userArea=new P,this._idParamAngleX=E.getIdManager().getId(b.ParamAngleX),this._idParamAngleY=E.getIdManager().getId(b.ParamAngleY),this._idParamAngleZ=E.getIdManager().getId(b.ParamAngleZ),this._idParamEyeBallX=E.getIdManager().getId(b.ParamEyeBallX),this._idParamEyeBallY=E.getIdManager().getId(b.ParamEyeBallY),this._idParamBodyAngleX=E.getIdManager().getId(b.ParamBodyAngleX),this._mocConsistency=!0,this._state=0,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._wavFileHandler=new Vi,this._consistency=!1}}class ia{constructor(){this._listExpressions=[],this.getlist()}getlist(){fetch("./model/march_7/march_7.model3.json").then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.FileReferences.Expressions.forEach(i=>{this._listExpressions.push(i.Name)})}).catch(e=>{console.error("There was a problem with the fetch operation:",e)})}setExpression(t){const e=rt.getInstance().getModel(0);e&&e.setExpression(t)}setExpressions(t){const e=rt.getInstance().getModel(0);e&&e.setExpressions(t)}setrandomExpression(){const t=rt.getInstance().getModel(0);if(t){const e=Math.floor(Math.random()*this._listExpressions.length),i=this._listExpressions[e];t.setExpression(i)}}getlistExpressions(){return this._listExpressions}stopExpression(){const t=rt.getInstance().getModel(0);t&&t.stopExpression()}}let zt=null;class rt{constructor(){this._finishedMotion=t=>{V.printMessage("Motion Finished:"),console.log(t)},this._viewMatrix=new k,this._models=new P,this._sceneIndex=0,this.changeScene(this._sceneIndex)}static getInstance(){return zt==null&&(zt=new rt),zt}static releaseInstance(){zt!=null&&(zt=void 0),zt=null}getModel(t){return t<this._models.getSize()?this._models.at(t):null}releaseAllModel(){for(let t=0;t<this._models.getSize();t++)this._models.at(t).release(),this._models.set(t,null);this._models.clear()}onDrag(t,e){for(let i=0;i<this._models.getSize();i++){const r=this.getModel(i);r&&r.setDragging(t,e)}}onTap(t,e){V.printMessage(`[APP]tap point: {x: ${t.toFixed(2)} y: ${e.toFixed(2)}}`);for(let i=0;i<this._models.getSize();i++)this._models.at(i).hitTest(Qi,t,e)?(V.printMessage(`[APP]hit area: [${Qi}]`),this._models.at(i).setRandomExpression()):this._models.at(i).hitTest(ts,t,e)&&(V.printMessage(`[APP]hit area: [${ts}]`),this._models.at(i).startRandomMotion(qa,Ja,this._finishedMotion))}onUpdate(){const{width:t,height:e}=L,i=this._models.getSize();for(let r=0;r<i;++r){const a=new k,n=this.getModel(r);n.getModel()&&(n.getModel().getCanvasWidth()>1&&t<e?(n.getModelMatrix().setWidth(2),a.scale(1,t/e)):a.scale(e/t,1),this._viewMatrix!=null&&a.multiplyByMatrix(this._viewMatrix)),n.update(),n.draw(a)}}nextScene(){const t=(this._sceneIndex+1)%$a;this.changeScene(t)}changeScene(t){this._sceneIndex=t,V.printMessage(`[APP]model index: ${this._sceneIndex}`);const e=_i[t],i=Br+e+"/";let r=_i[t];r+=".model3.json",V.printMessage(`[APP]model Path: ${i}`),this.releaseAllModel(),this._models.pushBack(new zo),this._models.at(0).loadAssets(i,r),this._expressionManager=new ia}setViewMatrix(t){for(let e=0;e<16;e++)this._viewMatrix.getArray()[e]=t.getArray()[e]}}class Xo{constructor(){this._textures=new P}release(){for(let t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())y.deleteTexture(t.ptr().id);this._textures=null}createTextureFromPngFile(t,e,i){for(let a=this._textures.begin();a.notEqual(this._textures.end());a.preIncrement())if(a.ptr().fileName==t&&a.ptr().usePremultply==e){a.ptr().img=new Image,a.ptr().img.addEventListener("load",()=>i(a.ptr()),{passive:!0}),a.ptr().img.src=t;return}const r=new Image;r.addEventListener("load",()=>{const a=y.createTexture();y.bindTexture(y.TEXTURE_2D,a),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR_MIPMAP_LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR),e&&y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,r),y.generateMipmap(y.TEXTURE_2D),y.bindTexture(y.TEXTURE_2D,null);const n=new jo;n!=null&&(n.fileName=t,n.width=r.width,n.height=r.height,n.id=a,n.img=r,n.usePremultply=e,this._textures.pushBack(n)),i(n)},{passive:!0}),r.src=t}releaseTextures(){for(let t=0;t<this._textures.getSize();t++)this._textures.set(t,null);this._textures.clear()}releaseTextureByTexture(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id==t){this._textures.set(e,null),this._textures.remove(e);break}}releaseTextureByFilePath(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName==t){this._textures.set(e,null),this._textures.remove(e);break}}}class jo{constructor(){this.id=null,this.width=0,this.height=0}}class sa extends k{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);k.multiply(i,this._tr,this._tr)}adjustScale(t,e,i){const r=this.getMaxScale(),a=this.getMinScale(),n=i*this._tr[0];n<a?this._tr[0]>0&&(i=a/this._tr[0]):n>r&&this._tr[0]>0&&(i=r/this._tr[0]);const o=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),l=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),h=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);k.multiply(h,this._tr,this._tr),k.multiply(l,this._tr,this._tr),k.multiply(o,this._tr,this._tr)}setScreenRect(t,e,i,r){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=r}setMaxScreenRect(t,e,i,r){this._maxLeft=t,this._maxRight=e,this._maxTop=r,this._maxBottom=i}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}var nr;(s=>{s.CubismViewMatrix=sa})(nr||(nr={}));class or{constructor(t,e,i,r,a){this._rect=new Yo,this._rect.left=t-i*.3,this._rect.right=t+i*.5,this._rect.up=e+r*.5,this._rect.down=e-r*.5,this._texture=a,this._vertexBuffer=null,this._uvBuffer=null,this._indexBuffer=null,this._positionLocation=null,this._uvLocation=null,this._textureLocation=null,this._positionArray=null,this._uvArray=null,this._indexArray=null,this._firstDraw=!0}release(){this._rect=null,y.deleteTexture(this._texture),this._texture=null,y.deleteBuffer(this._uvBuffer),this._uvBuffer=null,y.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null,y.deleteBuffer(this._indexBuffer),this._indexBuffer=null}getTexture(){return this._texture}render(t){if(this._texture!=null){if(this._firstDraw){this._positionLocation=y.getAttribLocation(t,"position"),y.enableVertexAttribArray(this._positionLocation),this._uvLocation=y.getAttribLocation(t,"uv"),y.enableVertexAttribArray(this._uvLocation),this._textureLocation=y.getUniformLocation(t,"texture"),y.uniform1i(this._textureLocation,0),this._uvArray=new Float32Array([1,0,0,0,0,1,1,1]),this._uvBuffer=y.createBuffer();{const e=L.width,i=L.height;this._positionArray=new Float32Array([(this._rect.right-e*.5)/(e*.5),(this._rect.up-i*.5)/(i*.5),(this._rect.left-e*.3)/(e*.3),(this._rect.up-i*.5)/(i*.5),(this._rect.left-e*.5)/(e*.5),(this._rect.down-i*.5)/(i*.5),(this._rect.right-e*.5)/(e*.5),(this._rect.down-i*.5)/(i*.5)]),this._vertexBuffer=y.createBuffer()}this._indexArray=new Uint16Array([0,1,2,3,2,0]),this._indexBuffer=y.createBuffer(),this._firstDraw=!1}y.bindBuffer(y.ARRAY_BUFFER,this._uvBuffer),y.bufferData(y.ARRAY_BUFFER,this._uvArray,y.STATIC_DRAW),y.vertexAttribPointer(this._uvLocation,2,y.FLOAT,!1,0,0),y.bindBuffer(y.ARRAY_BUFFER,this._vertexBuffer),y.bufferData(y.ARRAY_BUFFER,this._positionArray,y.STATIC_DRAW),y.vertexAttribPointer(this._positionLocation,2,y.FLOAT,!1,0,0),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,this._indexBuffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,this._indexArray,y.DYNAMIC_DRAW),y.bindTexture(y.TEXTURE_2D,this._texture),y.drawElements(y.TRIANGLES,this._indexArray.length,y.UNSIGNED_SHORT,0)}}isHit(t,e){const{height:i}=L,r=i-e;return t>=this._rect.left&&t<=this._rect.right&&r<=this._rect.up&&r>=this._rect.down}}class Yo{}class Ho{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(t,e){this._lastX=t,this._lastY=e,this._startX=t,this._startY=e,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(t,e){this._lastX=t,this._lastY=e,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(t,e,i,r){return Math.sqrt((t-i)*(t-i)+(e-r)*(e-r))}calculateMovingAmount(t,e){if(t>0!=e>0)return 0;const i=t>0?1:-1,r=Math.abs(t),a=Math.abs(e);return i*(r<a?r:a)}}class $o{constructor(){this._programId=null,this._back=null,this._gear=null,this._touchManager=new Ho,this._deviceToScreen=new k,this._viewMatrix=new sa}initialize(){const{width:t,height:e}=L,i=t/e,r=-i,a=i,n=ka,o=Na;if(this._viewMatrix.setScreenRect(r,a,n,o),this._viewMatrix.scale(Zi,Zi),this._deviceToScreen.loadIdentity(),t>e){const l=Math.abs(a-r);this._deviceToScreen.scaleRelative(l/t,-l/t)}else{const l=Math.abs(o-n);this._deviceToScreen.scaleRelative(l/e,-l/e)}this._deviceToScreen.translateRelative(-t*.5,-e*.5),this._viewMatrix.setMaxScale(La),this._viewMatrix.setMinScale(Oa),this._viewMatrix.setMaxScreenRect(Ua,za,Xa,ja)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,this._gear.release(),this._gear=null,this._back.release(),this._back=null,y.deleteProgram(this._programId),this._programId=null}render(){y.useProgram(this._programId),this._back&&this._back.render(this._programId),this._gear&&this._gear.render(this._programId),y.flush();const t=rt.getInstance();t.setViewMatrix(this._viewMatrix),t.onUpdate()}initializeSprite(){const t=L.width,e=L.height,i=A.getInstance().getTextureManager(),r=Br;let a="";if(a=Ya,a!=""){const n=o=>{const l=t*.5,h=e*.5,u=o.width*2,g=e*.95;this._back=new or(l,h,u,g,o.id)};i.createTextureFromPngFile(r+a,!1,n)}if(a=Ha,a!=""){const n=o=>{const l=t-o.width*.5,h=e-o.height*.5,u=o.width,g=o.height;this._gear=new or(l,h,u,g,o.id)};i.createTextureFromPngFile(r+a,!1,n),this._programId==null&&(this._programId=A.getInstance().createShader())}}onTouchesBegan(t,e){this._touchManager.touchesBegan(t*window.devicePixelRatio,e*window.devicePixelRatio)}onTouchesMoved(t,e){const i=this.transformViewX(this._touchManager.getX()),r=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(t*window.devicePixelRatio,e*window.devicePixelRatio),rt.getInstance().onDrag(i,r)}onTouchesEnded(t,e){const i=rt.getInstance();i.onDrag(0,0);{const r=this._deviceToScreen.transformX(this._touchManager.getX()),a=this._deviceToScreen.transformY(this._touchManager.getY());i.onTap(r,a),this._gear&&this._gear.isHit(t*window.devicePixelRatio,e*window.devicePixelRatio)&&i.nextScene()}}transformViewX(t){const e=this._deviceToScreen.transformX(t);return this._viewMatrix.invertTransformX(e)}transformViewY(t){const e=this._deviceToScreen.transformY(t);return this._viewMatrix.invertTransformY(e)}transformScreenX(t){return this._deviceToScreen.transformX(t)}transformScreenY(t){return this._deviceToScreen.transformY(t)}}class ra{}class Go extends ra{createsvgElement(t){const e=document.createElement("div");e.style.position="fixed",e.style.display="block";const i="http://www.w3.org/2000/svg",r=document.createElementNS(i,"svg");r.classList.add("icon"),r.setAttribute("viewBox","0 0 24 24");const a=document.createElementNS(i,"use");return a.setAttribute("href",`#${t}`),r.appendChild(a),e.appendChild(r),document.body.appendChild(e),e}hideIcon(t){t.style.display="none"}}class qo extends ra{createsvgElement(t){const e=document.createElement("div");e.style.position="absolute",e.style.display="none";const i="http://www.w3.org/2000/svg",r=document.createElementNS(i,"svg");r.classList.add("icon"),r.setAttribute("viewBox","0 0 24 24");const a=document.createElementNS(i,"use");return a.setAttribute("href",`#${t}`),r.appendChild(a),e.appendChild(r),document.body.appendChild(e),e}changeIcon(t,e){t.setAttribute("href",`#${e}`)}hideIcon(t){t.style.display="none"}}class Wo{constructor(){this.initializeUI()}initializeUI(){this.createsettleicon("icon-siyecao").classList.add("icon-settle")}createsettleicon(t){return new Go().createsvgElement(`${t}`)}createplayicon(t){return new qo().createsvgElement(`${t}`)}seticon(t,e){const r=t.firstChild.firstChild;r&&r.setAttribute("href",`#${e}`)}rotateicon(t,e){const r=t.firstChild.firstChild;e?r.classList.add("rotate"):r.classList.remove("rotate")}}function aa(s,t){return function(){return s.apply(t,arguments)}}const{toString:Jo}=Object.prototype,{getPrototypeOf:Fi}=Object,{iterator:He,toStringTag:na}=Symbol,$e=(s=>t=>{const e=Jo.call(t);return s[e]||(s[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),at=s=>(s=s.toLowerCase(),t=>$e(t)===s),Ge=s=>t=>typeof t===s,{isArray:Kt}=Array,Jt=Ge("undefined");function fe(s){return s!==null&&!Jt(s)&&s.constructor!==null&&!Jt(s.constructor)&&Y(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const oa=at("ArrayBuffer");function Ko(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&oa(s.buffer),t}const Zo=Ge("string"),Y=Ge("function"),la=Ge("number"),pe=s=>s!==null&&typeof s=="object",Qo=s=>s===!0||s===!1,Te=s=>{if($e(s)!=="object")return!1;const t=Fi(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(na in s)&&!(He in s)},tl=s=>{if(!pe(s)||fe(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},el=at("Date"),il=at("File"),sl=at("Blob"),rl=at("FileList"),al=s=>pe(s)&&Y(s.pipe),nl=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||Y(s.append)&&((t=$e(s))==="formdata"||t==="object"&&Y(s.toString)&&s.toString()==="[object FormData]"))},ol=at("URLSearchParams"),[ll,ul,hl,cl]=["ReadableStream","Request","Response","Headers"].map(at),gl=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ye(s,t,{allOwnKeys:e=!1}={}){if(s===null||typeof s>"u")return;let i,r;if(typeof s!="object"&&(s=[s]),Kt(s))for(i=0,r=s.length;i<r;i++)t.call(null,s[i],i,s);else{if(fe(s))return;const a=e?Object.getOwnPropertyNames(s):Object.keys(s),n=a.length;let o;for(i=0;i<n;i++)o=a[i],t.call(null,s[o],o,s)}}function ua(s,t){if(fe(s))return null;t=t.toLowerCase();const e=Object.keys(s);let i=e.length,r;for(;i-- >0;)if(r=e[i],t===r.toLowerCase())return r;return null}const Vt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ha=s=>!Jt(s)&&s!==Vt;function Si(){const{caseless:s,skipUndefined:t}=ha(this)&&this||{},e={},i=(r,a)=>{const n=s&&ua(e,a)||a;Te(e[n])&&Te(r)?e[n]=Si(e[n],r):Te(r)?e[n]=Si({},r):Kt(r)?e[n]=r.slice():(!t||!Jt(r))&&(e[n]=r)};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&ye(arguments[r],i);return e}const dl=(s,t,e,{allOwnKeys:i}={})=>(ye(t,(r,a)=>{e&&Y(r)?s[a]=aa(r,e):s[a]=r},{allOwnKeys:i}),s),_l=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),ml=(s,t,e,i)=>{s.prototype=Object.create(t.prototype,i),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),e&&Object.assign(s.prototype,e)},fl=(s,t,e,i)=>{let r,a,n;const o={};if(t=t||{},s==null)return t;do{for(r=Object.getOwnPropertyNames(s),a=r.length;a-- >0;)n=r[a],(!i||i(n,s,t))&&!o[n]&&(t[n]=s[n],o[n]=!0);s=e!==!1&&Fi(s)}while(s&&(!e||e(s,t))&&s!==Object.prototype);return t},pl=(s,t,e)=>{s=String(s),(e===void 0||e>s.length)&&(e=s.length),e-=t.length;const i=s.indexOf(t,e);return i!==-1&&i===e},yl=s=>{if(!s)return null;if(Kt(s))return s;let t=s.length;if(!la(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=s[t];return e},Sl=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&Fi(Uint8Array)),xl=(s,t)=>{const i=(s&&s[He]).call(s);let r;for(;(r=i.next())&&!r.done;){const a=r.value;t.call(s,a[0],a[1])}},Cl=(s,t)=>{let e;const i=[];for(;(e=s.exec(t))!==null;)i.push(e);return i},Pl=at("HTMLFormElement"),bl=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,i,r){return i.toUpperCase()+r}),lr=(({hasOwnProperty:s})=>(t,e)=>s.call(t,e))(Object.prototype),Ml=at("RegExp"),ca=(s,t)=>{const e=Object.getOwnPropertyDescriptors(s),i={};ye(e,(r,a)=>{let n;(n=t(r,a,s))!==!1&&(i[a]=n||r)}),Object.defineProperties(s,i)},wl=s=>{ca(s,(t,e)=>{if(Y(s)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const i=s[e];if(Y(i)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},Bl=(s,t)=>{const e={},i=r=>{r.forEach(a=>{e[a]=!0})};return Kt(s)?i(s):i(String(s).split(t)),e},Il=()=>{},vl=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function Rl(s){return!!(s&&Y(s.append)&&s[na]==="FormData"&&s[He])}const El=s=>{const t=new Array(10),e=(i,r)=>{if(pe(i)){if(t.indexOf(i)>=0)return;if(fe(i))return i;if(!("toJSON"in i)){t[r]=i;const a=Kt(i)?[]:{};return ye(i,(n,o)=>{const l=e(n,r+1);!Jt(l)&&(a[o]=l)}),t[r]=void 0,a}}return i};return e(s,0)},Tl=at("AsyncFunction"),Vl=s=>s&&(pe(s)||Y(s))&&Y(s.then)&&Y(s.catch),ga=((s,t)=>s?setImmediate:t?((e,i)=>(Vt.addEventListener("message",({source:r,data:a})=>{r===Vt&&a===e&&i.length&&i.shift()()},!1),r=>{i.push(r),Vt.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Y(Vt.postMessage)),Fl=typeof queueMicrotask<"u"?queueMicrotask.bind(Vt):typeof process<"u"&&process.nextTick||ga,Al=s=>s!=null&&Y(s[He]),m={isArray:Kt,isArrayBuffer:oa,isBuffer:fe,isFormData:nl,isArrayBufferView:Ko,isString:Zo,isNumber:la,isBoolean:Qo,isObject:pe,isPlainObject:Te,isEmptyObject:tl,isReadableStream:ll,isRequest:ul,isResponse:hl,isHeaders:cl,isUndefined:Jt,isDate:el,isFile:il,isBlob:sl,isRegExp:Ml,isFunction:Y,isStream:al,isURLSearchParams:ol,isTypedArray:Sl,isFileList:rl,forEach:ye,merge:Si,extend:dl,trim:gl,stripBOM:_l,inherits:ml,toFlatObject:fl,kindOf:$e,kindOfTest:at,endsWith:pl,toArray:yl,forEachEntry:xl,matchAll:Cl,isHTMLForm:Pl,hasOwnProperty:lr,hasOwnProp:lr,reduceDescriptors:ca,freezeMethods:wl,toObjectSet:Bl,toCamelCase:bl,noop:Il,toFiniteNumber:vl,findKey:ua,global:Vt,isContextDefined:ha,isSpecCompliantForm:Rl,toJSONObject:El,isAsyncFn:Tl,isThenable:Vl,setImmediate:ga,asap:Fl,isIterable:Al};function R(s,t,e,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}m.inherits(R,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:m.toJSONObject(this.config),code:this.code,status:this.status}}});const da=R.prototype,_a={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{_a[s]={value:s}});Object.defineProperties(R,_a);Object.defineProperty(da,"isAxiosError",{value:!0});R.from=(s,t,e,i,r,a)=>{const n=Object.create(da);m.toFlatObject(s,n,function(u){return u!==Error.prototype},h=>h!=="isAxiosError");const o=s&&s.message?s.message:"Error",l=t==null&&s?s.code:t;return R.call(n,o,l,e,i,r),s&&n.cause==null&&Object.defineProperty(n,"cause",{value:s,configurable:!0}),n.name=s&&s.name||"Error",a&&Object.assign(n,a),n};const Dl=null;function xi(s){return m.isPlainObject(s)||m.isArray(s)}function ma(s){return m.endsWith(s,"[]")?s.slice(0,-2):s}function ur(s,t,e){return s?s.concat(t).map(function(r,a){return r=ma(r),!e&&a?"["+r+"]":r}).join(e?".":""):t}function Ll(s){return m.isArray(s)&&!s.some(xi)}const Ol=m.toFlatObject(m,{},null,function(t){return/^is[A-Z]/.test(t)});function qe(s,t,e){if(!m.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,e=m.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,_){return!m.isUndefined(_[p])});const i=e.metaTokens,r=e.visitor||u,a=e.dots,n=e.indexes,l=(e.Blob||typeof Blob<"u"&&Blob)&&m.isSpecCompliantForm(t);if(!m.isFunction(r))throw new TypeError("visitor must be a function");function h(c){if(c===null)return"";if(m.isDate(c))return c.toISOString();if(m.isBoolean(c))return c.toString();if(!l&&m.isBlob(c))throw new R("Blob is not supported. Use a Buffer instead.");return m.isArrayBuffer(c)||m.isTypedArray(c)?l&&typeof Blob=="function"?new Blob([c]):Buffer.from(c):c}function u(c,p,_){let S=c;if(c&&!_&&typeof c=="object"){if(m.endsWith(p,"{}"))p=i?p:p.slice(0,-2),c=JSON.stringify(c);else if(m.isArray(c)&&Ll(c)||(m.isFileList(c)||m.endsWith(p,"[]"))&&(S=m.toArray(c)))return p=ma(p),S.forEach(function(C,w){!(m.isUndefined(C)||C===null)&&t.append(n===!0?ur([p],w,a):n===null?p:p+"[]",h(C))}),!1}return xi(c)?!0:(t.append(ur(_,p,a),h(c)),!1)}const g=[],f=Object.assign(Ol,{defaultVisitor:u,convertValue:h,isVisitable:xi});function d(c,p){if(!m.isUndefined(c)){if(g.indexOf(c)!==-1)throw Error("Circular reference detected in "+p.join("."));g.push(c),m.forEach(c,function(S,x){(!(m.isUndefined(S)||S===null)&&r.call(t,S,m.isString(x)?x.trim():x,p,f))===!0&&d(S,p?p.concat(x):[x])}),g.pop()}}if(!m.isObject(s))throw new TypeError("data must be an object");return d(s),t}function hr(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function Ai(s,t){this._pairs=[],s&&qe(s,this,t)}const fa=Ai.prototype;fa.append=function(t,e){this._pairs.push([t,e])};fa.toString=function(t){const e=t?function(i){return t.call(this,i,hr)}:hr;return this._pairs.map(function(r){return e(r[0])+"="+e(r[1])},"").join("&")};function kl(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function pa(s,t,e){if(!t)return s;const i=e&&e.encode||kl;m.isFunction(e)&&(e={serialize:e});const r=e&&e.serialize;let a;if(r?a=r(t,e):a=m.isURLSearchParams(t)?t.toString():new Ai(t,e).toString(i),a){const n=s.indexOf("#");n!==-1&&(s=s.slice(0,n)),s+=(s.indexOf("?")===-1?"?":"&")+a}return s}class cr{constructor(){this.handlers=[]}use(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){m.forEach(this.handlers,function(i){i!==null&&t(i)})}}const ya={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Nl=typeof URLSearchParams<"u"?URLSearchParams:Ai,Ul=typeof FormData<"u"?FormData:null,zl=typeof Blob<"u"?Blob:null,Xl={isBrowser:!0,classes:{URLSearchParams:Nl,FormData:Ul,Blob:zl},protocols:["http","https","file","blob","url","data"]},Di=typeof window<"u"&&typeof document<"u",Ci=typeof navigator=="object"&&navigator||void 0,jl=Di&&(!Ci||["ReactNative","NativeScript","NS"].indexOf(Ci.product)<0),Yl=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Hl=Di&&window.location.href||"http://localhost",$l=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Di,hasStandardBrowserEnv:jl,hasStandardBrowserWebWorkerEnv:Yl,navigator:Ci,origin:Hl},Symbol.toStringTag,{value:"Module"})),z={...$l,...Xl};function Gl(s,t){return qe(s,new z.classes.URLSearchParams,{visitor:function(e,i,r,a){return z.isNode&&m.isBuffer(e)?(this.append(i,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...t})}function ql(s){return m.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Wl(s){const t={},e=Object.keys(s);let i;const r=e.length;let a;for(i=0;i<r;i++)a=e[i],t[a]=s[a];return t}function Sa(s){function t(e,i,r,a){let n=e[a++];if(n==="__proto__")return!0;const o=Number.isFinite(+n),l=a>=e.length;return n=!n&&m.isArray(r)?r.length:n,l?(m.hasOwnProp(r,n)?r[n]=[r[n],i]:r[n]=i,!o):((!r[n]||!m.isObject(r[n]))&&(r[n]=[]),t(e,i,r[n],a)&&m.isArray(r[n])&&(r[n]=Wl(r[n])),!o)}if(m.isFormData(s)&&m.isFunction(s.entries)){const e={};return m.forEachEntry(s,(i,r)=>{t(ql(i),r,e,0)}),e}return null}function Jl(s,t,e){if(m.isString(s))try{return(t||JSON.parse)(s),m.trim(s)}catch(i){if(i.name!=="SyntaxError")throw i}return(e||JSON.stringify)(s)}const Se={transitional:ya,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const i=e.getContentType()||"",r=i.indexOf("application/json")>-1,a=m.isObject(t);if(a&&m.isHTMLForm(t)&&(t=new FormData(t)),m.isFormData(t))return r?JSON.stringify(Sa(t)):t;if(m.isArrayBuffer(t)||m.isBuffer(t)||m.isStream(t)||m.isFile(t)||m.isBlob(t)||m.isReadableStream(t))return t;if(m.isArrayBufferView(t))return t.buffer;if(m.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(a){if(i.indexOf("application/x-www-form-urlencoded")>-1)return Gl(t,this.formSerializer).toString();if((o=m.isFileList(t))||i.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return qe(o?{"files[]":t}:t,l&&new l,this.formSerializer)}}return a||r?(e.setContentType("application/json",!1),Jl(t)):t}],transformResponse:[function(t){const e=this.transitional||Se.transitional,i=e&&e.forcedJSONParsing,r=this.responseType==="json";if(m.isResponse(t)||m.isReadableStream(t))return t;if(t&&m.isString(t)&&(i&&!this.responseType||r)){const n=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t,this.parseReviver)}catch(o){if(n)throw o.name==="SyntaxError"?R.from(o,R.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:z.classes.FormData,Blob:z.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};m.forEach(["delete","get","head","post","put","patch"],s=>{Se.headers[s]={}});const Kl=m.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Zl=s=>{const t={};let e,i,r;return s&&s.split(`
`).forEach(function(n){r=n.indexOf(":"),e=n.substring(0,r).trim().toLowerCase(),i=n.substring(r+1).trim(),!(!e||t[e]&&Kl[e])&&(e==="set-cookie"?t[e]?t[e].push(i):t[e]=[i]:t[e]=t[e]?t[e]+", "+i:i)}),t},gr=Symbol("internals");function ie(s){return s&&String(s).trim().toLowerCase()}function Ve(s){return s===!1||s==null?s:m.isArray(s)?s.map(Ve):String(s)}function Ql(s){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=e.exec(s);)t[i[1]]=i[2];return t}const tu=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function ui(s,t,e,i,r){if(m.isFunction(i))return i.call(this,t,e);if(r&&(t=e),!!m.isString(t)){if(m.isString(i))return t.indexOf(i)!==-1;if(m.isRegExp(i))return i.test(t)}}function eu(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,i)=>e.toUpperCase()+i)}function iu(s,t){const e=m.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(s,i+e,{value:function(r,a,n){return this[i].call(this,t,r,a,n)},configurable:!0})})}let H=class{constructor(t){t&&this.set(t)}set(t,e,i){const r=this;function a(o,l,h){const u=ie(l);if(!u)throw new Error("header name must be a non-empty string");const g=m.findKey(r,u);(!g||r[g]===void 0||h===!0||h===void 0&&r[g]!==!1)&&(r[g||l]=Ve(o))}const n=(o,l)=>m.forEach(o,(h,u)=>a(h,u,l));if(m.isPlainObject(t)||t instanceof this.constructor)n(t,e);else if(m.isString(t)&&(t=t.trim())&&!tu(t))n(Zl(t),e);else if(m.isObject(t)&&m.isIterable(t)){let o={},l,h;for(const u of t){if(!m.isArray(u))throw TypeError("Object iterator must return a key-value pair");o[h=u[0]]=(l=o[h])?m.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}n(o,e)}else t!=null&&a(e,t,i);return this}get(t,e){if(t=ie(t),t){const i=m.findKey(this,t);if(i){const r=this[i];if(!e)return r;if(e===!0)return Ql(r);if(m.isFunction(e))return e.call(this,r,i);if(m.isRegExp(e))return e.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=ie(t),t){const i=m.findKey(this,t);return!!(i&&this[i]!==void 0&&(!e||ui(this,this[i],i,e)))}return!1}delete(t,e){const i=this;let r=!1;function a(n){if(n=ie(n),n){const o=m.findKey(i,n);o&&(!e||ui(i,i[o],o,e))&&(delete i[o],r=!0)}}return m.isArray(t)?t.forEach(a):a(t),r}clear(t){const e=Object.keys(this);let i=e.length,r=!1;for(;i--;){const a=e[i];(!t||ui(this,this[a],a,t,!0))&&(delete this[a],r=!0)}return r}normalize(t){const e=this,i={};return m.forEach(this,(r,a)=>{const n=m.findKey(i,a);if(n){e[n]=Ve(r),delete e[a];return}const o=t?eu(a):String(a).trim();o!==a&&delete e[a],e[o]=Ve(r),i[o]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return m.forEach(this,(i,r)=>{i!=null&&i!==!1&&(e[r]=t&&m.isArray(i)?i.join(", "):i)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const i=new this(t);return e.forEach(r=>i.set(r)),i}static accessor(t){const i=(this[gr]=this[gr]={accessors:{}}).accessors,r=this.prototype;function a(n){const o=ie(n);i[o]||(iu(r,n),i[o]=!0)}return m.isArray(t)?t.forEach(a):a(t),this}};H.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);m.reduceDescriptors(H.prototype,({value:s},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(i){this[e]=i}}});m.freezeMethods(H);function hi(s,t){const e=this||Se,i=t||e,r=H.from(i.headers);let a=i.data;return m.forEach(s,function(o){a=o.call(e,a,r.normalize(),t?t.status:void 0)}),r.normalize(),a}function xa(s){return!!(s&&s.__CANCEL__)}function Zt(s,t,e){R.call(this,s??"canceled",R.ERR_CANCELED,t,e),this.name="CanceledError"}m.inherits(Zt,R,{__CANCEL__:!0});function Ca(s,t,e){const i=e.config.validateStatus;!e.status||!i||i(e.status)?s(e):t(new R("Request failed with status code "+e.status,[R.ERR_BAD_REQUEST,R.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function su(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function ru(s,t){s=s||10;const e=new Array(s),i=new Array(s);let r=0,a=0,n;return t=t!==void 0?t:1e3,function(l){const h=Date.now(),u=i[a];n||(n=h),e[r]=l,i[r]=h;let g=a,f=0;for(;g!==r;)f+=e[g++],g=g%s;if(r=(r+1)%s,r===a&&(a=(a+1)%s),h-n<t)return;const d=u&&h-u;return d?Math.round(f*1e3/d):void 0}}function au(s,t){let e=0,i=1e3/t,r,a;const n=(h,u=Date.now())=>{e=u,r=null,a&&(clearTimeout(a),a=null),s(...h)};return[(...h)=>{const u=Date.now(),g=u-e;g>=i?n(h,u):(r=h,a||(a=setTimeout(()=>{a=null,n(r)},i-g)))},()=>r&&n(r)]}const ze=(s,t,e=3)=>{let i=0;const r=ru(50,250);return au(a=>{const n=a.loaded,o=a.lengthComputable?a.total:void 0,l=n-i,h=r(l),u=n<=o;i=n;const g={loaded:n,total:o,progress:o?n/o:void 0,bytes:l,rate:h||void 0,estimated:h&&o&&u?(o-n)/h:void 0,event:a,lengthComputable:o!=null,[t?"download":"upload"]:!0};s(g)},e)},dr=(s,t)=>{const e=s!=null;return[i=>t[0]({lengthComputable:e,total:s,loaded:i}),t[1]]},_r=s=>(...t)=>m.asap(()=>s(...t)),nu=z.hasStandardBrowserEnv?((s,t)=>e=>(e=new URL(e,z.origin),s.protocol===e.protocol&&s.host===e.host&&(t||s.port===e.port)))(new URL(z.origin),z.navigator&&/(msie|trident)/i.test(z.navigator.userAgent)):()=>!0,ou=z.hasStandardBrowserEnv?{write(s,t,e,i,r,a,n){if(typeof document>"u")return;const o=[`${s}=${encodeURIComponent(t)}`];m.isNumber(e)&&o.push(`expires=${new Date(e).toUTCString()}`),m.isString(i)&&o.push(`path=${i}`),m.isString(r)&&o.push(`domain=${r}`),a===!0&&o.push("secure"),m.isString(n)&&o.push(`SameSite=${n}`),document.cookie=o.join("; ")},read(s){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+s+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(s){this.write(s,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function lu(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function uu(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function Pa(s,t,e){let i=!lu(t);return s&&(i||e==!1)?uu(s,t):t}const mr=s=>s instanceof H?{...s}:s;function At(s,t){t=t||{};const e={};function i(h,u,g,f){return m.isPlainObject(h)&&m.isPlainObject(u)?m.merge.call({caseless:f},h,u):m.isPlainObject(u)?m.merge({},u):m.isArray(u)?u.slice():u}function r(h,u,g,f){if(m.isUndefined(u)){if(!m.isUndefined(h))return i(void 0,h,g,f)}else return i(h,u,g,f)}function a(h,u){if(!m.isUndefined(u))return i(void 0,u)}function n(h,u){if(m.isUndefined(u)){if(!m.isUndefined(h))return i(void 0,h)}else return i(void 0,u)}function o(h,u,g){if(g in t)return i(h,u);if(g in s)return i(void 0,h)}const l={url:a,method:a,data:a,baseURL:n,transformRequest:n,transformResponse:n,paramsSerializer:n,timeout:n,timeoutMessage:n,withCredentials:n,withXSRFToken:n,adapter:n,responseType:n,xsrfCookieName:n,xsrfHeaderName:n,onUploadProgress:n,onDownloadProgress:n,decompress:n,maxContentLength:n,maxBodyLength:n,beforeRedirect:n,transport:n,httpAgent:n,httpsAgent:n,cancelToken:n,socketPath:n,responseEncoding:n,validateStatus:o,headers:(h,u,g)=>r(mr(h),mr(u),g,!0)};return m.forEach(Object.keys({...s,...t}),function(u){const g=l[u]||r,f=g(s[u],t[u],u);m.isUndefined(f)&&g!==o||(e[u]=f)}),e}const ba=s=>{const t=At({},s);let{data:e,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:a,headers:n,auth:o}=t;if(t.headers=n=H.from(n),t.url=pa(Pa(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),o&&n.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),m.isFormData(e)){if(z.hasStandardBrowserEnv||z.hasStandardBrowserWebWorkerEnv)n.setContentType(void 0);else if(m.isFunction(e.getHeaders)){const l=e.getHeaders(),h=["content-type","content-length"];Object.entries(l).forEach(([u,g])=>{h.includes(u.toLowerCase())&&n.set(u,g)})}}if(z.hasStandardBrowserEnv&&(i&&m.isFunction(i)&&(i=i(t)),i||i!==!1&&nu(t.url))){const l=r&&a&&ou.read(a);l&&n.set(r,l)}return t},hu=typeof XMLHttpRequest<"u",cu=hu&&function(s){return new Promise(function(e,i){const r=ba(s);let a=r.data;const n=H.from(r.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:h}=r,u,g,f,d,c;function p(){d&&d(),c&&c(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let _=new XMLHttpRequest;_.open(r.method.toUpperCase(),r.url,!0),_.timeout=r.timeout;function S(){if(!_)return;const C=H.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),B={data:!o||o==="text"||o==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:C,config:s,request:_};Ca(function(T){e(T),p()},function(T){i(T),p()},B),_=null}"onloadend"in _?_.onloadend=S:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(S)},_.onabort=function(){_&&(i(new R("Request aborted",R.ECONNABORTED,s,_)),_=null)},_.onerror=function(w){const B=w&&w.message?w.message:"Network Error",v=new R(B,R.ERR_NETWORK,s,_);v.event=w||null,i(v),_=null},_.ontimeout=function(){let w=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const B=r.transitional||ya;r.timeoutErrorMessage&&(w=r.timeoutErrorMessage),i(new R(w,B.clarifyTimeoutError?R.ETIMEDOUT:R.ECONNABORTED,s,_)),_=null},a===void 0&&n.setContentType(null),"setRequestHeader"in _&&m.forEach(n.toJSON(),function(w,B){_.setRequestHeader(B,w)}),m.isUndefined(r.withCredentials)||(_.withCredentials=!!r.withCredentials),o&&o!=="json"&&(_.responseType=r.responseType),h&&([f,c]=ze(h,!0),_.addEventListener("progress",f)),l&&_.upload&&([g,d]=ze(l),_.upload.addEventListener("progress",g),_.upload.addEventListener("loadend",d)),(r.cancelToken||r.signal)&&(u=C=>{_&&(i(!C||C.type?new Zt(null,s,_):C),_.abort(),_=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const x=su(r.url);if(x&&z.protocols.indexOf(x)===-1){i(new R("Unsupported protocol "+x+":",R.ERR_BAD_REQUEST,s));return}_.send(a||null)})},gu=(s,t)=>{const{length:e}=s=s?s.filter(Boolean):[];if(t||e){let i=new AbortController,r;const a=function(h){if(!r){r=!0,o();const u=h instanceof Error?h:this.reason;i.abort(u instanceof R?u:new Zt(u instanceof Error?u.message:u))}};let n=t&&setTimeout(()=>{n=null,a(new R(`timeout ${t} of ms exceeded`,R.ETIMEDOUT))},t);const o=()=>{s&&(n&&clearTimeout(n),n=null,s.forEach(h=>{h.unsubscribe?h.unsubscribe(a):h.removeEventListener("abort",a)}),s=null)};s.forEach(h=>h.addEventListener("abort",a));const{signal:l}=i;return l.unsubscribe=()=>m.asap(o),l}},du=function*(s,t){let e=s.byteLength;if(e<t){yield s;return}let i=0,r;for(;i<e;)r=i+t,yield s.slice(i,r),i=r},_u=async function*(s,t){for await(const e of mu(s))yield*du(e,t)},mu=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:e,value:i}=await t.read();if(e)break;yield i}}finally{await t.cancel()}},fr=(s,t,e,i)=>{const r=_u(s,t);let a=0,n,o=l=>{n||(n=!0,i&&i(l))};return new ReadableStream({async pull(l){try{const{done:h,value:u}=await r.next();if(h){o(),l.close();return}let g=u.byteLength;if(e){let f=a+=g;e(f)}l.enqueue(new Uint8Array(u))}catch(h){throw o(h),h}},cancel(l){return o(l),r.return()}},{highWaterMark:2})},pr=64*1024,{isFunction:ve}=m,fu=(({Request:s,Response:t})=>({Request:s,Response:t}))(m.global),{ReadableStream:yr,TextEncoder:Sr}=m.global,xr=(s,...t)=>{try{return!!s(...t)}catch{return!1}},pu=s=>{s=m.merge.call({skipUndefined:!0},fu,s);const{fetch:t,Request:e,Response:i}=s,r=t?ve(t):typeof fetch=="function",a=ve(e),n=ve(i);if(!r)return!1;const o=r&&ve(yr),l=r&&(typeof Sr=="function"?(c=>p=>c.encode(p))(new Sr):async c=>new Uint8Array(await new e(c).arrayBuffer())),h=a&&o&&xr(()=>{let c=!1;const p=new e(z.origin,{body:new yr,method:"POST",get duplex(){return c=!0,"half"}}).headers.has("Content-Type");return c&&!p}),u=n&&o&&xr(()=>m.isReadableStream(new i("").body)),g={stream:u&&(c=>c.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(c=>{!g[c]&&(g[c]=(p,_)=>{let S=p&&p[c];if(S)return S.call(p);throw new R(`Response type '${c}' is not supported`,R.ERR_NOT_SUPPORT,_)})});const f=async c=>{if(c==null)return 0;if(m.isBlob(c))return c.size;if(m.isSpecCompliantForm(c))return(await new e(z.origin,{method:"POST",body:c}).arrayBuffer()).byteLength;if(m.isArrayBufferView(c)||m.isArrayBuffer(c))return c.byteLength;if(m.isURLSearchParams(c)&&(c=c+""),m.isString(c))return(await l(c)).byteLength},d=async(c,p)=>{const _=m.toFiniteNumber(c.getContentLength());return _??f(p)};return async c=>{let{url:p,method:_,data:S,signal:x,cancelToken:C,timeout:w,onDownloadProgress:B,onUploadProgress:v,responseType:T,headers:X,withCredentials:Z="same-origin",fetchOptions:ht}=ba(c),ct=t||fetch;T=T?(T+"").toLowerCase():"text";let nt=gu([x,C&&C.toAbortSignal()],w),Mt=null;const wt=nt&&nt.unsubscribe&&(()=>{nt.unsubscribe()});let Oi;try{if(v&&h&&_!=="get"&&_!=="head"&&(Oi=await d(X,S))!==0){let mt=new e(p,{method:"POST",body:S,duplex:"half"}),Dt;if(m.isFormData(S)&&(Dt=mt.headers.get("content-type"))&&X.setContentType(Dt),mt.body){const[Je,xe]=dr(Oi,ze(_r(v)));S=fr(mt.body,pr,Je,xe)}}m.isString(Z)||(Z=Z?"include":"omit");const ot=a&&"credentials"in e.prototype,ki={...ht,signal:nt,method:_.toUpperCase(),headers:X.normalize().toJSON(),body:S,duplex:"half",credentials:ot?Z:void 0};Mt=a&&new e(p,ki);let _t=await(a?ct(Mt,ht):ct(p,ki));const Ni=u&&(T==="stream"||T==="response");if(u&&(B||Ni&&wt)){const mt={};["status","statusText","headers"].forEach(Ui=>{mt[Ui]=_t[Ui]});const Dt=m.toFiniteNumber(_t.headers.get("content-length")),[Je,xe]=B&&dr(Dt,ze(_r(B),!0))||[];_t=new i(fr(_t.body,pr,Je,()=>{xe&&xe(),wt&&wt()}),mt)}T=T||"text";let Ra=await g[m.findKey(g,T)||"text"](_t,c);return!Ni&&wt&&wt(),await new Promise((mt,Dt)=>{Ca(mt,Dt,{data:Ra,headers:H.from(_t.headers),status:_t.status,statusText:_t.statusText,config:c,request:Mt})})}catch(ot){throw wt&&wt(),ot&&ot.name==="TypeError"&&/Load failed|fetch/i.test(ot.message)?Object.assign(new R("Network Error",R.ERR_NETWORK,c,Mt),{cause:ot.cause||ot}):R.from(ot,ot&&ot.code,c,Mt)}}},yu=new Map,Ma=s=>{let t=s&&s.env||{};const{fetch:e,Request:i,Response:r}=t,a=[i,r,e];let n=a.length,o=n,l,h,u=yu;for(;o--;)l=a[o],h=u.get(l),h===void 0&&u.set(l,h=o?new Map:pu(t)),u=h;return h};Ma();const Li={http:Dl,xhr:cu,fetch:{get:Ma}};m.forEach(Li,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const Cr=s=>`- ${s}`,Su=s=>m.isFunction(s)||s===null||s===!1;function xu(s,t){s=m.isArray(s)?s:[s];const{length:e}=s;let i,r;const a={};for(let n=0;n<e;n++){i=s[n];let o;if(r=i,!Su(i)&&(r=Li[(o=String(i)).toLowerCase()],r===void 0))throw new R(`Unknown adapter '${o}'`);if(r&&(m.isFunction(r)||(r=r.get(t))))break;a[o||"#"+n]=r}if(!r){const n=Object.entries(a).map(([l,h])=>`adapter ${l} `+(h===!1?"is not supported by the environment":"is not available in the build"));let o=e?n.length>1?`since :
`+n.map(Cr).join(`
`):" "+Cr(n[0]):"as no adapter specified";throw new R("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r}const wa={getAdapter:xu,adapters:Li};function ci(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new Zt(null,s)}function Pr(s){return ci(s),s.headers=H.from(s.headers),s.data=hi.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),wa.getAdapter(s.adapter||Se.adapter,s)(s).then(function(i){return ci(s),i.data=hi.call(s,s.transformResponse,i),i.headers=H.from(i.headers),i},function(i){return xa(i)||(ci(s),i&&i.response&&(i.response.data=hi.call(s,s.transformResponse,i.response),i.response.headers=H.from(i.response.headers))),Promise.reject(i)})}const Ba="1.13.2",We={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{We[s]=function(i){return typeof i===s||"a"+(t<1?"n ":" ")+s}});const br={};We.transitional=function(t,e,i){function r(a,n){return"[Axios v"+Ba+"] Transitional option '"+a+"'"+n+(i?". "+i:"")}return(a,n,o)=>{if(t===!1)throw new R(r(n," has been removed"+(e?" in "+e:"")),R.ERR_DEPRECATED);return e&&!br[n]&&(br[n]=!0,console.warn(r(n," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(a,n,o):!0}};We.spelling=function(t){return(e,i)=>(console.warn(`${i} is likely a misspelling of ${t}`),!0)};function Cu(s,t,e){if(typeof s!="object")throw new R("options must be an object",R.ERR_BAD_OPTION_VALUE);const i=Object.keys(s);let r=i.length;for(;r-- >0;){const a=i[r],n=t[a];if(n){const o=s[a],l=o===void 0||n(o,a,s);if(l!==!0)throw new R("option "+a+" must be "+l,R.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new R("Unknown option "+a,R.ERR_BAD_OPTION)}}const Fe={assertOptions:Cu,validators:We},lt=Fe.validators;let Ft=class{constructor(t){this.defaults=t||{},this.interceptors={request:new cr,response:new cr}}async request(t,e){try{return await this._request(t,e)}catch(i){if(i instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const a=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?a&&!String(i.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+a):i.stack=a}catch{}}throw i}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=At(this.defaults,e);const{transitional:i,paramsSerializer:r,headers:a}=e;i!==void 0&&Fe.assertOptions(i,{silentJSONParsing:lt.transitional(lt.boolean),forcedJSONParsing:lt.transitional(lt.boolean),clarifyTimeoutError:lt.transitional(lt.boolean)},!1),r!=null&&(m.isFunction(r)?e.paramsSerializer={serialize:r}:Fe.assertOptions(r,{encode:lt.function,serialize:lt.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),Fe.assertOptions(e,{baseUrl:lt.spelling("baseURL"),withXsrfToken:lt.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let n=a&&m.merge(a.common,a[e.method]);a&&m.forEach(["delete","get","head","post","put","patch","common"],c=>{delete a[c]}),e.headers=H.concat(n,a);const o=[];let l=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(e)===!1||(l=l&&p.synchronous,o.unshift(p.fulfilled,p.rejected))});const h=[];this.interceptors.response.forEach(function(p){h.push(p.fulfilled,p.rejected)});let u,g=0,f;if(!l){const c=[Pr.bind(this),void 0];for(c.unshift(...o),c.push(...h),f=c.length,u=Promise.resolve(e);g<f;)u=u.then(c[g++],c[g++]);return u}f=o.length;let d=e;for(;g<f;){const c=o[g++],p=o[g++];try{d=c(d)}catch(_){p.call(this,_);break}}try{u=Pr.call(this,d)}catch(c){return Promise.reject(c)}for(g=0,f=h.length;g<f;)u=u.then(h[g++],h[g++]);return u}getUri(t){t=At(this.defaults,t);const e=Pa(t.baseURL,t.url,t.allowAbsoluteUrls);return pa(e,t.params,t.paramsSerializer)}};m.forEach(["delete","get","head","options"],function(t){Ft.prototype[t]=function(e,i){return this.request(At(i||{},{method:t,url:e,data:(i||{}).data}))}});m.forEach(["post","put","patch"],function(t){function e(i){return function(a,n,o){return this.request(At(o||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:a,data:n}))}}Ft.prototype[t]=e(),Ft.prototype[t+"Form"]=e(!0)});let Pu=class Ia{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(a){e=a});const i=this;this.promise.then(r=>{if(!i._listeners)return;let a=i._listeners.length;for(;a-- >0;)i._listeners[a](r);i._listeners=null}),this.promise.then=r=>{let a;const n=new Promise(o=>{i.subscribe(o),a=o}).then(r);return n.cancel=function(){i.unsubscribe(a)},n},t(function(a,n,o){i.reason||(i.reason=new Zt(a,n,o),e(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=i=>{t.abort(i)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Ia(function(r){t=r}),cancel:t}}};function bu(s){return function(e){return s.apply(null,e)}}function Mu(s){return m.isObject(s)&&s.isAxiosError===!0}const Pi={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Pi).forEach(([s,t])=>{Pi[t]=s});function va(s){const t=new Ft(s),e=aa(Ft.prototype.request,t);return m.extend(e,Ft.prototype,t,{allOwnKeys:!0}),m.extend(e,t,null,{allOwnKeys:!0}),e.create=function(r){return va(At(s,r))},e}const O=va(Se);O.Axios=Ft;O.CanceledError=Zt;O.CancelToken=Pu;O.isCancel=xa;O.VERSION=Ba;O.toFormData=qe;O.AxiosError=R;O.Cancel=O.CanceledError;O.all=function(t){return Promise.all(t)};O.spread=bu;O.isAxiosError=Mu;O.mergeConfig=At;O.AxiosHeaders=H;O.formToJSON=s=>Sa(m.isHTMLForm(s)?new FormData(s):s);O.getAdapter=wa.getAdapter;O.HttpStatusCode=Pi;O.default=O;const{Axios:Lu,AxiosError:Ou,CanceledError:ku,isCancel:Nu,CancelToken:Uu,VERSION:zu,all:Xu,Cancel:ju,isAxiosError:Yu,spread:Hu,toFormData:$u,AxiosHeaders:Gu,HttpStatusCode:qu,formToJSON:Wu,getAdapter:Ju,mergeConfig:Ku}=O;class wu{constructor(){this.apiUrl="https://sanyue.yidongliu5.workers.dev/?https://www.tts-webui.com/api/gen",this.headers={Accept:"application/json","Accept-Language":"zh-CN,zh;q=0.9,en;q=0.8",Priority:"u=1, i","Content-Type":"application/json"}}async sendRequest(t){const e={text:t,speaker_id:0,sdp_ratio:.2,noise:.2,noisew:.9,length:1,auto_translate:!1,auto_split:!0,emotion:"Happy",style_text:"",style_weight:.7};try{return await O.post(this.apiUrl,e,{headers:this.headers,responseType:"blob"})}catch(i){throw console.error("Error sending request:",i),i}}recieveResponse(){}playText(t){console.log("Playing audio at:",t)}}class Bu{constructor(){this.showicon=!1,this.iconElement=null,this.iconLeft=0,this.iconTop=0,this._UIcontroller=new Wo,this._requestHandler=new wu,this._expressionManager=new ia,this._text="",this._isrotate=!1,this.handleKeyDown=async t=>{if(t.ctrlKey&&t.key==="q")try{const i=(await this._requestHandler.sendRequest(this._text)).data,r=URL.createObjectURL(i),a=new Audio(r);a.play().catch(n=>{console.error("Error playing audio:",n)}),a.addEventListener("ended",()=>{URL.revokeObjectURL(r)})}catch(e){console.error("Error fetching or processing audio:",e)}},this.handleIconClick=async()=>{this._UIcontroller.seticon(this.iconElement,"icon-jiazai"),this._isrotate=!0,this._UIcontroller.rotateicon(this.iconElement,this._isrotate);try{const e=(await this._requestHandler.sendRequest(this._text)).data,i=URL.createObjectURL(e),r=new Audio(i);this._isrotate=!1,this._UIcontroller.rotateicon(this.iconElement,this._isrotate),this._UIcontroller.seticon(this.iconElement,"icon-bofang"),r.play().catch(a=>{console.error("Error playing audio:",a)}),r.addEventListener("ended",()=>{URL.revokeObjectURL(i)})}catch(t){console.error("Error fetching or processing audio:",t)}},this.handleKeyDownForExpression=t=>{this._expressionManager.getlistExpressions().forEach((i,r)=>{t.ctrlKey&&t.key===(r+1).toString()&&this._expressionManager.setExpression(i)}),t.ctrlKey&&t.key==="0"&&O.post("http://localhost:8000/getNeutralExpression",{}).then(i=>{const r=i.data.neutralExpression;this._expressionManager.setExpressions(r)}).catch(i=>{console.error("Error fetching neutral expression:",i)})},this.init()}init(){this.getplaysvg(),this.addMouseUpListener(),document.addEventListener("keydown",this.handleKeyDownForExpression)}getplaysvg(){const t=this._UIcontroller.createplayicon("icon-bofang");this.iconElement=t}addMouseUpListener(){document.addEventListener("mouseup",this.handleMouseUp.bind(this))}handleMouseUp(){const t=window.getSelection();if(t.rangeCount>0&&t.toString().trim()!==""){this._text=t.toString();const i=t.getRangeAt(0).getBoundingClientRect();document.addEventListener("keydown",this.handleKeyDown),this.updateIconPosition(i),this.showIcon()}}showIcon(){this.showicon=!0,this.iconElement.style.display="block",this.setupIconClickListener()}hideIcon(){this.showicon=!1,this.iconElement.style.display="none",this.iconElement.removeEventListener("click",this.handleIconClick)}setupIconClickListener(){this.iconElement.removeEventListener("click",this.handleIconClick),this.iconElement.addEventListener("click",this.handleIconClick)}updateIconPosition(t){this.iconLeft=t.x+t.width+window.scrollX-20,this.iconTop=t.top+t.height+window.scrollY+25,this.iconElement&&(this.iconElement.style.left=`${this.iconLeft}px`,this.iconElement.style.top=`${this.iconTop}px`)}}let Rt=null,bi=null;class A{static getInstance(){return Rt==null&&(Rt=new A),Rt}static releaseInstance(){Rt!=null&&Rt.release(),Rt=null}initialize(){var t=document.getElementById("sanyue");return t.appendChild(L),this._resizeCanvas(),bi||(bi=y.getParameter(y.FRAMEBUFFER_BINDING)),y.enable(y.BLEND),y.blendFunc(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA),"ontouchend"in L?(L.addEventListener("touchstart",Eu,{passive:!0}),L.addEventListener("touchmove",Tu,{passive:!0}),L.addEventListener("touchend",Vu,{passive:!0}),L.addEventListener("touchcancel",Fu,{passive:!0})):(L.addEventListener("mousedown",Iu,{passive:!0}),L.addEventListener("mousemove",vu,{passive:!0}),L.addEventListener("mouseup",Ru,{passive:!0})),this._view.initialize(),this.initializeCubism(),!0}onResize(){this._resizeCanvas(),this._view.initialize(),this._view.initializeSprite()}release(){this._textureManager.release(),this._textureManager=null,this._view.release(),this._view=null,rt.releaseInstance(),E.dispose()}run(){const t=()=>{Rt!=null&&(V.updateTime(),y.clearColor(0,0,0,0),y.enable(y.DEPTH_TEST),y.depthFunc(y.LEQUAL),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),y.clearDepth(1),y.enable(y.BLEND),y.blendFunc(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA),this._view.render(),requestAnimationFrame(t))};t()}createShader(){const t=y.createShader(y.VERTEX_SHADER);if(t==null)return V.printMessage("failed to create vertexShader"),null;y.shaderSource(t,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),y.compileShader(t);const i=y.createShader(y.FRAGMENT_SHADER);if(i==null)return V.printMessage("failed to create fragmentShader"),null;y.shaderSource(i,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),y.compileShader(i);const a=y.createProgram();return y.attachShader(a,t),y.attachShader(a,i),y.deleteShader(t),y.deleteShader(i),y.linkProgram(a),y.useProgram(a),a}getView(){return this._view}getTextureManager(){return this._textureManager}constructor(){this._captured=!1,this._mouseX=0,this._mouseY=0,this._isEnd=!1,this._cubismOption=new Aa,this._view=new $o,this._textureManager=new Xo,this._monitor=new Bu}initializeCubism(){this._cubismOption.logFunction=V.printMessage,this._cubismOption.loggingLevel=Ka,E.startUp(this._cubismOption),E.initialize(),rt.getInstance(),V.updateTime(),this._view.initializeSprite()}_resizeCanvas(){L.width=L.clientWidth*window.devicePixelRatio,L.height=L.clientHeight*window.devicePixelRatio,y.viewport(0,0,y.drawingBufferWidth,y.drawingBufferHeight)}}function Iu(s){if(!A.getInstance()._view){V.printMessage("view notfound");return}A.getInstance()._captured=!0;const t=s.pageX,e=s.pageY;A.getInstance()._view.onTouchesBegan(t,e)}function vu(s){if(!A.getInstance()._captured)return;if(!A.getInstance()._view){V.printMessage("view notfound");return}const t=s.target.getBoundingClientRect(),e=s.clientX-t.left,i=s.clientY-t.top;A.getInstance()._view.onTouchesMoved(e,i)}function Ru(s){if(A.getInstance()._captured=!1,!A.getInstance()._view){V.printMessage("view notfound");return}const t=s.target.getBoundingClientRect(),e=s.clientX-t.left,i=s.clientY-t.top;A.getInstance()._view.onTouchesEnded(e,i)}function Eu(s){if(!A.getInstance()._view){V.printMessage("view notfound");return}A.getInstance()._captured=!0;const t=s.changedTouches[0].pageX,e=s.changedTouches[0].pageY;A.getInstance()._view.onTouchesBegan(t,e)}function Tu(s){if(!A.getInstance()._captured)return;if(!A.getInstance()._view){V.printMessage("view notfound");return}const t=s.target.getBoundingClientRect(),e=s.changedTouches[0].clientX-t.left,i=s.changedTouches[0].clientY-t.top;A.getInstance()._view.onTouchesMoved(e,i)}function Vu(s){if(A.getInstance()._captured=!1,!A.getInstance()._view){V.printMessage("view notfound");return}const t=s.target.getBoundingClientRect(),e=s.changedTouches[0].clientX-t.left,i=s.changedTouches[0].clientY-t.top;A.getInstance()._view.onTouchesEnded(e,i)}function Fu(s){if(A.getInstance()._captured=!1,!A.getInstance()._view){V.printMessage("view notfound");return}const t=s.target.getBoundingClientRect(),e=s.changedTouches[0].clientX-t.left,i=s.changedTouches[0].clientY-t.top;A.getInstance()._view.onTouchesEnded(e,i)}window.addEventListener("load",()=>{!Bi.getInstance()||!A.getInstance().initialize()||A.getInstance().run()},{passive:!0});window.addEventListener("beforeunload",()=>A.releaseInstance(),{passive:!0});
//# sourceMappingURL=index-BKVZ7f-F.js.map
